<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WR Cleaning Service</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#2563eb;--primary-light:#dbeafe;--primary-dark:#1d4ed8;--secondary:#10b981;--secondary-light:#d1fae5;--destructive:#ef4444;--destructive-light:#fee2e2;--warning:#f97316;--warning-light:#ffedd5;--bg:#f8fafc;--card:#ffffff;--border:#e2e8f0;--text:#0f172a;--text-muted:#64748b;--sidebar-w:240px;--header-h:64px;--radius:10px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
button{cursor:pointer;font-family:inherit;border:none;background:none}
input,select,textarea{font-family:inherit}
.hidden{display:none!important}
.mb-4{margin-bottom:16px}.mt-4{margin-top:16px}

/* TOAST */
#toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;font-size:13px;font-weight:500;box-shadow:0 8px 24px rgba(0,0,0,.12);min-width:260px;display:flex;align-items:center;gap:8px;animation:slideIn .25s ease}
.toast.success{border-left:4px solid var(--secondary)}
.toast.error{border-left:4px solid var(--destructive)}
@keyframes slideIn{from{transform:translateX(60px);opacity:0}to{transform:translateX(0);opacity:1}}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px;animation:fadeIn .15s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--card);border-radius:14px;padding:28px;width:100%;max-width:460px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 64px rgba(0,0,0,.18)}
.modal h2{font-size:18px;font-weight:700;margin-bottom:20px}
.modal-lg{max-width:600px}

/* FORMS */
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:13px;font-weight:500;margin-bottom:5px}
.form-control{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;outline:none;transition:border-color .15s;background:#fff}
.form-control:focus{border-color:var(--primary)}
select.form-control{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
textarea.form-control{resize:vertical;min-height:80px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;transition:all .15s;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff;border:1.5px solid var(--primary)}
.btn-primary:hover{background:var(--primary-dark)}
.btn-secondary{background:var(--secondary);color:#fff;border:1.5px solid var(--secondary)}
.btn-outline{background:transparent;color:var(--text);border:1.5px solid var(--border)}
.btn-outline:hover{background:var(--bg)}
.btn-ghost{background:transparent;color:var(--text-muted);border:1.5px solid transparent;padding:6px 10px}
.btn-ghost:hover{background:var(--bg);color:var(--text)}
.btn-danger{background:var(--destructive-light);color:var(--destructive);border:1.5px solid transparent}
.btn-danger:hover{background:var(--destructive);color:#fff}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-icon{padding:7px;border-radius:7px}
.btn-full{width:100%}

/* BADGE */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:99px;font-size:11px;font-weight:600}
.badge-primary{background:var(--primary-light);color:var(--primary)}
.badge-secondary{background:var(--secondary-light);color:var(--secondary)}
.badge-destructive{background:var(--destructive-light);color:var(--destructive)}
.badge-warning{background:var(--warning-light);color:var(--warning)}
.badge-gray{background:#f1f5f9;color:var(--text-muted)}
.badge-pending{background:var(--primary-light);color:var(--primary)}

/* CARD */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius)}
.card-header{padding:16px 20px 8px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-header h3{font-size:15px;font-weight:700}
.card-body{padding:16px 20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px}
.stat-card .stat-label{font-size:12px;font-weight:500;color:var(--text-muted);margin-bottom:4px}
.stat-card .stat-value{font-size:26px;font-weight:700}

/* TABLE */
.table{width:100%;border-collapse:collapse;font-size:13px}
.table th{text-align:left;padding:10px 12px;font-weight:600;border-bottom:2px solid var(--border);color:var(--text-muted);font-size:12px}
.table td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.table tr:last-child td{border-bottom:none}
.table tr:hover td{background:var(--bg)}
.table-responsive{overflow-x:auto}

/* LOGIN */
#login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary-light) 0%,#fff 50%,var(--secondary-light) 100%);padding:20px}
.login-card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:40px;width:100%;max-width:420px;box-shadow:0 20px 60px rgba(37,99,235,.1)}
.login-logo{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:28px}
.login-logo .spark{color:var(--primary);font-size:36px;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.login-logo h1{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center}
.login-logo p{font-size:13px;color:var(--text-muted)}
.login-switch{text-align:center;font-size:13px;color:var(--text-muted);margin-top:10px}
.login-switch button{color:var(--primary);font-weight:600;cursor:pointer}
.login-switch button:hover{text-decoration:underline}

/* APP */
#app-page,#emp-app-page{display:flex;flex-direction:column;min-height:100vh}
.app-header{height:var(--header-h);background:var(--card);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;position:sticky;top:0;z-index:100;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.header-logo{display:flex;align-items:center;gap:10px}
.header-logo .spark{color:var(--primary);font-size:22px}
.header-logo h2{font-size:16px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-logo span{font-size:10px;color:var(--text-muted);display:block}
.header-right{display:flex;align-items:center;gap:12px}
.user-info .name{font-size:13px;font-weight:600}
.user-info .email{font-size:11px;color:var(--text-muted)}
.app-body{display:flex;flex:1}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w);background:var(--card);border-right:1px solid var(--border);padding:12px 10px;position:sticky;top:var(--header-h);height:calc(100vh - var(--header-h));overflow-y:auto;flex-shrink:0}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;font-size:13px;font-weight:500;color:var(--text-muted);cursor:pointer;transition:all .15s;width:100%}
.nav-item:hover{background:var(--bg);color:var(--text)}
.nav-item.active{background:var(--primary);color:#fff}
.nav-item .icon{font-size:16px;flex-shrink:0}
.nav-badge{margin-left:auto;background:var(--destructive);color:#fff;font-size:10px;font-weight:700;border-radius:99px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;padding:0 4px}
.main-content{flex:1;padding:24px;overflow-x:hidden}

/* TABS */
.tab-content{display:none;animation:fadeUp .2s ease}
.tab-content.active{display:block}
@keyframes fadeUp{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.page-header h2{font-size:22px;font-weight:800}

/* GRID */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.divider{border:none;border-top:1px solid var(--border);margin:16px 0}

/* NOTIF BANNER */
.notif-banner{background:var(--destructive-light);border:1px solid #fca5a5;border-radius:var(--radius);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:20px}
.notif-banner .title{font-weight:700;color:var(--destructive);font-size:14px}
.notif-banner .desc{font-size:12px;color:var(--text-muted)}

/* LOG ROW */
.log-row{border:1px solid var(--border);border-radius:8px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.log-row:hover{border-color:var(--primary)}
.log-row .log-date{font-size:12px;color:var(--text-muted)}
.log-row .log-client{font-size:14px;font-weight:600}
.log-row .log-employees{font-size:12px;color:var(--text-muted);margin-top:4px}
.log-row .log-revenue{font-size:16px;font-weight:700;color:var(--secondary)}

/* WEEK SCHEDULE */
.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.day-col{border:1px solid var(--border);border-radius:8px;min-height:100px;padding:8px}
.day-col .day-label{font-size:11px;font-weight:700;text-align:center;color:var(--text-muted);margin-bottom:6px}
.day-col .day-num{font-size:16px;font-weight:700;text-align:center;margin-bottom:8px}
.day-col.today{border-color:var(--primary);background:var(--primary-light)}
.schedule-item{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:6px 8px;font-size:11px;margin-bottom:4px}
.schedule-item.confirmado{border-left:3px solid var(--secondary)}
.schedule-item.pendente{border-left:3px solid var(--warning)}
.schedule-item.cancelado{border-left:3px solid var(--destructive);opacity:.7}

/* COST */
.cost-item{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--border);border-radius:8px;margin-bottom:8px}
.cost-item:hover{border-color:var(--primary)}
.cost-item .cost-cat{font-size:11px;font-weight:600;color:var(--text-muted)}
.cost-item .cost-desc{font-size:14px;font-weight:500}
.cost-item .cost-amount{font-size:16px;font-weight:700}

/* REFERRAL */
.referral-item{border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:8px}
.referral-item.pending{border-left:4px solid var(--warning)}
.referral-item.approved{border-left:4px solid var(--secondary)}
.referral-item.rejected{border-left:4px solid var(--destructive)}

/* SUMMARY */
.summary-block{background:var(--bg);border-radius:8px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.summary-block .emp-name{font-size:13px;font-weight:600}
.summary-block .emp-count{font-size:12px;color:var(--text-muted)}
.summary-block .emp-total{font-size:16px;font-weight:700;color:var(--primary)}

/* PROFILE */
.profile-avatar{width:72px;height:72px;border-radius:99px;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;font-weight:700}

/* FREQ */
.freq-item{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px}
.freq-item:hover{border-color:var(--primary);background:var(--bg)}

/* NOTIF ITEM */
.notif-item{border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:8px}
.notif-item.pending{border-left:4px solid var(--destructive)}
.notif-item.read{border-left:4px solid var(--border);opacity:.8}

/* EMPTY */
.empty{text-align:center;padding:48px 20px;color:var(--text-muted);font-size:14px}
.empty .icon{font-size:40px;margin-bottom:8px}

/* TABS NAV */
.tabs-nav{display:flex;gap:4px;background:var(--bg);border-radius:8px;padding:4px;margin-bottom:16px}
.tab-btn{flex:1;padding:7px 10px;border-radius:6px;font-size:12px;font-weight:600;color:var(--text-muted);text-align:center;cursor:pointer;transition:all .15s}
.tab-btn.active{background:var(--card);color:var(--primary);box-shadow:0 1px 4px rgba(0,0,0,.1)}

/* EMP TAB */
.emp-tab-btn{padding:12px 16px;font-size:13px;font-weight:600;color:var(--text-muted);border-bottom:2px solid transparent;cursor:pointer;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap;transition:all .15s}
.emp-tab-btn.active{color:var(--primary);border-bottom-color:var(--primary)}
.emp-tab-btn:hover{color:var(--text);background:var(--bg)}
.emp-pill{display:inline-flex;align-items:center;gap:6px;background:var(--primary-light);color:var(--primary);border-radius:99px;padding:3px 10px;font-size:12px;font-weight:500}

/* MOBILE */
.mobile-menu-btn{display:none}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:150;top:var(--header-h)}
@media(max-width:768px){
  .sidebar{display:none;position:fixed;left:0;top:var(--header-h);height:calc(100vh - var(--header-h));z-index:200;transform:translateX(-100%);transition:transform .25s}
  .sidebar.open{display:flex;flex-direction:column;transform:translateX(0)}
  .mobile-menu-btn{display:flex}
  .main-content{padding:16px}
  .grid-4{grid-template-columns:1fr 1fr}
  .grid-3{grid-template-columns:1fr 1fr}
  .grid-2{grid-template-columns:1fr}
  .week-grid{grid-template-columns:repeat(4,1fr)}
  .user-info{display:none}
  .sidebar-overlay.open{display:block}
}
</style>
</head>
<body>

<div id="toast-container"></div>

<!-- ‚ïê‚ïê LOGIN ‚ïê‚ïê -->
<div id="login-page">
  <div class="login-card">
    <div class="login-logo">
      <div class="spark">‚ú¶</div>
      <h1>WR Cleaning Service</h1>
      <p>Sistema de Gest√£o Financeira</p>
    </div>
    <div id="login-form">
      <div class="form-group">
        <label>Email</label>
        <input type="text" class="form-control" id="login-email" placeholder="seu@email.com"/>
      </div>
      <div class="form-group">
        <label>Senha</label>
        <input type="password" class="form-control" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
      </div>
      <button class="btn btn-primary btn-full" id="btn-login">Entrar</button>
      <div class="login-switch"><button id="btn-to-forgot">Esqueci minha senha</button></div>
      <div class="login-switch">N√£o tem conta? <button id="btn-to-register">Criar conta</button></div>
    </div>
    <div id="register-form" class="hidden">
      <div class="form-group"><label>Email</label><input type="email" class="form-control" placeholder="seu@email.com"/></div>
      <button class="btn btn-primary btn-full" id="btn-send-otp">Enviar C√≥digo</button>
      <div class="login-switch"><button id="btn-reg-back">Voltar ao Login</button></div>
    </div>
    <div id="forgot-form" class="hidden">
      <div class="form-group"><label>Email</label><input type="email" class="form-control" placeholder="seu@email.com"/></div>
      <button class="btn btn-primary btn-full" id="btn-send-forgot">Enviar C√≥digo de Verifica√ß√£o</button>
      <div class="login-switch"><button id="btn-forgot-back">Voltar ao login</button></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ADM APP ‚ïê‚ïê -->
<div id="app-page" class="hidden">
  <header class="app-header">
    <div style="display:flex;align-items:center;gap:12px">
      <button class="btn btn-ghost btn-icon mobile-menu-btn" id="menu-toggle">‚ò∞</button>
      <div class="header-logo">
        <span class="spark">‚ú¶</span>
        <div><h2>WR Cleaning Service</h2><span>Painel Administrativo</span></div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="name" id="header-username"></div>
        <div class="email" id="header-email"></div>
      </div>
      <button class="btn btn-outline btn-sm" id="btn-logout-adm">‚¨° Sair</button>
    </div>
  </header>
  <div class="app-body">
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav>
        <button class="nav-item active" data-tab="dashboard">‚äû <span>Dashboard</span></button>
        <button class="nav-item" data-tab="schedule">üìÖ <span>Schedule</span></button>
        <button class="nav-item" data-tab="checklist">üíµ <span>Pagamentos</span></button>
        <button class="nav-item" data-tab="clients">üë• <span>Clientes</span></button>
        <button class="nav-item" data-tab="employees">üíº <span>Funcion√°rios</span></button>
        <button class="nav-item" data-tab="costs">üßæ <span>Custos</span></button>
        <button class="nav-item" data-tab="notifications">üîî <span>Notifica√ß√µes</span><span class="nav-badge hidden" id="notif-badge">0</span></button>
        <button class="nav-item" data-tab="frequencies">üìÜ <span>Frequ√™ncias</span></button>
        <button class="nav-item" data-tab="referrals">üéÅ <span>Indica√ß√µes</span></button>
        <button class="nav-item" data-tab="profile">‚öô <span>Perfil</span></button>
      </nav>
    </aside>
    <main class="main-content">
      <div class="notif-banner hidden" id="main-notif-banner">
        <span style="font-size:18px;color:var(--destructive)">üîî</span>
        <div style="flex:1"><div class="title" id="banner-title"></div><div class="desc">Observa√ß√µes de funcion√°rios aguardam sua visualiza√ß√£o</div></div>
        <button class="btn btn-outline btn-sm" id="btn-banner-ver">Ver</button>
      </div>

      <!-- DASHBOARD -->
      <div class="tab-content active" id="tab-dashboard">
        <div class="card mb-4">
          <div class="card-header"><h3>Filtros de Per√≠odo</h3></div>
          <div class="card-body">
            <div class="grid-3" style="gap:12px">
              <div class="form-group" style="margin:0"><label>Data Inicial</label><input type="date" class="form-control" id="dash-start" value="2026-02-01"/></div>
              <div class="form-group" style="margin:0"><label>Data Final</label><input type="date" class="form-control" id="dash-end" value="2026-02-28"/></div>
              <div class="form-group" style="margin:0"><label>M√™s/Ano</label><input type="month" class="form-control" id="dash-month" value="2026-02"/></div>
            </div>
          </div>
        </div>
        <div class="grid-4 mb-4" id="dash-stats"></div>
        <div class="grid-3 mb-4" id="dash-secondary"></div>
        <div class="card">
          <div class="card-header"><h3>Ranking de Lucratividade por Cliente</h3></div>
          <div class="card-body table-responsive">
            <table class="table"><thead><tr><th>#</th><th>Cliente</th><th>Frequ√™ncia</th><th style="text-align:right">Valor Cobrado</th><th style="text-align:right">Custo M.O.</th><th style="text-align:right">Lucro</th></tr></thead><tbody id="ranking-body"></tbody></table>
          </div>
        </div>
      </div>

      <!-- SCHEDULE -->
      <div class="tab-content" id="tab-schedule">
        <div class="page-header">
          <h2>üìÖ Agenda Semanal</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn btn-outline btn-sm" id="prev-week">‚óÄ</button>
            <span id="week-label" style="font-size:13px;font-weight:600"></span>
            <button class="btn btn-outline btn-sm" id="next-week">‚ñ∂</button>
            <button class="btn btn-primary btn-sm" id="btn-add-schedule">+ Adicionar</button>
          </div>
        </div>
        <div class="week-grid" id="week-grid"></div>
        <div class="card mt-4"><div class="card-header"><h3>Lista de Agendamentos</h3></div><div class="card-body" id="schedule-list"></div></div>
      </div>

      <!-- CHECKLIST -->
      <div class="tab-content" id="tab-checklist">
        <div class="page-header">
          <h2>üíµ Registros de Trabalho</h2>
          <button class="btn btn-primary" id="btn-add-worklog">+ Novo Registro</button>
        </div>
        <div class="card mb-4">
          <div class="card-header"><h3>Filtros</h3></div>
          <div class="card-body">
            <div class="grid-3">
              <div class="form-group" style="margin:0"><label>Data Inicial</label><input type="date" class="form-control" id="cl-start" value="2026-02-01"/></div>
              <div class="form-group" style="margin:0"><label>Data Final</label><input type="date" class="form-control" id="cl-end" value="2026-02-28"/></div>
              <div class="form-group" style="margin:0"><label>M√™s/Ano</label><input type="month" class="form-control" id="cl-month" value="2026-02"/></div>
            </div>
          </div>
        </div>
        <div class="grid-2 mb-4">
          <div class="card"><div class="card-header"><h3>Resumo por Funcion√°ria</h3></div><div class="card-body" id="emp-payments-summary"></div></div>
          <div class="card"><div class="card-header"><h3>Status do Per√≠odo</h3></div><div class="card-body" id="cl-period-stats"></div></div>
        </div>
        <div id="work-logs-list"></div>
      </div>

      <!-- CLIENTS -->
      <div class="tab-content" id="tab-clients">
        <div class="page-header"><h2>üë• Clientes</h2><button class="btn btn-primary" id="btn-add-client">+ Adicionar Cliente</button></div>
        <div class="card"><div class="card-body table-responsive">
          <table class="table"><thead><tr><th>Nome</th><th>Frequ√™ncia</th><th>Valor</th><th>Funcion√°rias</th><th>Transporte</th><th>A√ß√µes</th></tr></thead><tbody id="clients-table-body"></tbody></table>
        </div></div>
      </div>

      <!-- EMPLOYEES -->
      <div class="tab-content" id="tab-employees">
        <div class="tabs-nav">
          <div class="tab-btn active" id="emp-tab-active">Funcion√°rios Ativos</div>
          <div class="tab-btn" id="emp-tab-pending">Usu√°rios Pendentes</div>
        </div>
        <div id="active-emps">
          <div class="page-header"><h2>üíº Funcion√°rios</h2><button class="btn btn-primary" id="btn-add-emp">+ Adicionar</button></div>
          <div class="card"><div class="card-body table-responsive">
            <table class="table"><thead><tr><th>Nome</th><th>Email</th><th>Desde</th><th>A√ß√µes</th></tr></thead><tbody id="emp-table-body"></tbody></table>
          </div></div>
        </div>
        <div id="pending-users" class="hidden">
          <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚è≥ Usu√°rios Pendentes</h2>
          <div id="pending-list"></div>
        </div>
      </div>

      <!-- COSTS -->
      <div class="tab-content" id="tab-costs">
        <div class="page-header"><h2>üßæ Custos</h2><button class="btn btn-primary" id="btn-add-cost">+ Adicionar Custo</button></div>
        <div class="grid-2 mb-4">
          <div class="stat-card" style="border-left:4px solid var(--primary)"><div class="stat-label">üîÑ Recorrentes / m√™s</div><div class="stat-value" style="color:var(--primary)" id="cost-recurrent">$0.00</div></div>
          <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">‚ö° √önicos</div><div class="stat-value" style="color:var(--warning)" id="cost-unique">$0.00</div></div>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:16px">
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-all">Todos</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-recorrente">Recorrentes</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-unico">√önicos</button>
        </div>
        <div id="costs-list"></div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="tab-content" id="tab-notifications">
        <div class="page-header">
          <h2>üîî Notifica√ß√µes</h2>
          <span class="badge badge-destructive" id="notif-count-badge"></span>
        </div>
        <div id="notifications-list"></div>
      </div>

      <!-- FREQUENCIES -->
      <div class="tab-content" id="tab-frequencies">
        <div class="page-header"><h2>üìÜ Frequ√™ncias</h2><button class="btn btn-primary" id="btn-add-freq">+ Adicionar</button></div>
        <div class="card"><div class="card-header"><h3>üìã Lista de Frequ√™ncias</h3></div><div class="card-body" id="freq-list"></div></div>
      </div>

      <!-- REFERRALS -->
      <div class="tab-content" id="tab-referrals">
        <div class="page-header"><h2>üéÅ Indica√ß√µes</h2></div>
        <div class="grid-3 mb-4" id="referral-stats"></div>
        <div id="referrals-list"></div>
      </div>

      <!-- PROFILE -->
      <div class="tab-content" id="tab-profile">
        <h2 style="font-size:22px;font-weight:800;margin-bottom:20px">‚öô Perfil</h2>
        <div class="card" style="max-width:480px"><div class="card-body">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
            <div class="profile-avatar" id="profile-avatar">A</div>
            <div><div style="font-size:18px;font-weight:700" id="profile-name">Admin</div><div style="font-size:13px;color:var(--text-muted)" id="profile-email-disp"></div><span class="badge badge-primary" style="margin-top:4px">Administrador</span></div>
          </div>
          <hr class="divider">
          <div class="form-group"><label>Nova Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
          <div class="form-group"><label>Confirmar Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
          <button class="btn btn-primary" id="btn-save-profile">Salvar Altera√ß√µes</button>
        </div></div>
      </div>
    </main>
  </div>
</div>

<!-- ‚ïê‚ïê EMPLOYEE APP ‚ïê‚ïê -->
<div id="emp-app-page" class="hidden">
  <header class="app-header">
    <div class="header-logo"><span class="spark">‚ú¶</span><div><h2>WR Cleaning</h2><span id="emp-header-sub">Colaboradora</span></div></div>
    <div class="header-right">
      <div class="user-info"><div class="name" id="emp-header-username"></div><div class="email" id="emp-header-email"></div></div>
      <button class="btn btn-outline btn-sm" id="btn-logout-emp">‚¨° Sair</button>
    </div>
  </header>
  <div style="background:var(--card);border-bottom:1px solid var(--border);overflow-x:auto">
    <div style="display:flex;min-width:max-content;padding:0 16px">
      <button class="emp-tab-btn active" data-etab="emp-ganhos">üí∞ Ganhos</button>
      <button class="emp-tab-btn" data-etab="emp-agenda">üìÖ Agenda</button>
      <button class="emp-tab-btn" data-etab="emp-clientes">üë• Clientes</button>
      <button class="emp-tab-btn" data-etab="emp-indique">üéÅ Indique</button>
      <button class="emp-tab-btn" data-etab="emp-perfil">‚öôÔ∏è Perfil</button>
    </div>
  </div>
  <main class="main-content">
    <!-- GANHOS -->
    <div class="tab-content active" id="tab-emp-ganhos">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üí∞ Meus Ganhos</h2>
      <div class="card mb-4"><div class="card-body" style="padding:12px 16px">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-outline btn-sm" style="border-radius:99px" data-period="semana">Esta semana</button>
          <button class="btn btn-primary btn-sm" style="border-radius:99px" data-period="mes">Este m√™s</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" data-period="ano">Este ano</button>
        </div>
      </div></div>
      <div class="grid-3 mb-4" id="emp-stats"></div>
      <div class="card"><div class="card-header"><h3>Hist√≥rico de Trabalhos</h3></div><div class="card-body" id="emp-work-list"></div></div>
    </div>
    <!-- AGENDA -->
    <div class="tab-content" id="tab-emp-agenda">
      <div class="page-header">
        <h2>üìÖ Minha Agenda</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn btn-outline btn-sm" id="emp-prev-week">‚óÄ</button>
          <span id="emp-week-label" style="font-size:13px;font-weight:600"></span>
          <button class="btn btn-outline btn-sm" id="emp-next-week">‚ñ∂</button>
        </div>
      </div>
      <div class="week-grid" id="emp-week-grid"></div>
      <div class="card mt-4"><div class="card-header"><h3>Agendamentos da Semana</h3></div><div class="card-body" id="emp-schedule-list"></div></div>
    </div>
    <!-- CLIENTES -->
    <div class="tab-content" id="tab-emp-clientes">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üë• Meus Clientes</h2>
      <div id="emp-clients-list"></div>
      <div class="card mt-4">
        <div class="card-header"><h3>üí¨ Minhas Observa√ß√µes</h3><button class="btn btn-primary btn-sm" id="btn-emp-note">+ Nova Observa√ß√£o</button></div>
        <div class="card-body" id="emp-notes-list"></div>
      </div>
    </div>
    <!-- INDIQUE -->
    <div class="tab-content" id="tab-emp-indique">
      <div class="page-header"><h2>üéÅ Indica√ß√µes</h2><button class="btn btn-primary" id="btn-emp-ref">+ Nova Indica√ß√£o</button></div>
      <div class="card mb-4" style="border-left:4px solid var(--secondary);background:var(--secondary-light)">
        <div class="card-body"><div style="font-weight:700;color:var(--secondary);margin-bottom:4px">üéÅ Como funciona?</div><div style="font-size:13px;color:#065f46">Indique um amigo e receba b√¥nus quando aprovado!</div></div>
      </div>
      <div class="grid-3 mb-4" id="emp-referrals-stats"></div>
      <div id="emp-referrals-list"></div>
    </div>
    <!-- PERFIL -->
    <div class="tab-content" id="tab-emp-perfil">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚öôÔ∏è Meu Perfil</h2>
      <div class="card" style="max-width:480px"><div class="card-body">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
          <div class="profile-avatar" id="emp-profile-avatar">A</div>
          <div><div style="font-size:18px;font-weight:700" id="emp-profile-name">Colaboradora</div><div style="font-size:13px;color:var(--text-muted)" id="emp-profile-email"></div><span class="badge badge-gray" style="margin-top:4px">Colaborador</span></div>
        </div>
        <hr class="divider">
        <div class="form-group"><label>Nova Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <div class="form-group"><label>Confirmar Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <button class="btn btn-primary btn-sm" id="btn-save-emp-profile">Salvar Senha</button>
      </div></div>
    </div>
  </main>
</div>

<!-- ‚ïê‚ïê MODALS ‚ïê‚ïê -->
<div class="modal-overlay hidden" id="schedule-modal">
  <div class="modal modal-lg"><h2>üìÖ Novo Agendamento</h2>
    <div class="form-group"><label>Data</label><input type="date" class="form-control" id="sch-date"/></div>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="sch-client"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Funcion√°ria</label><select class="form-control" id="sch-emp"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Status</label><select class="form-control" id="sch-status"><option value="pendente">Pendente</option><option value="confirmado">Confirmado</option><option value="cancelado">Cancelado</option></select></div>
    <div class="form-group"><label>Observa√ß√µes</label><textarea class="form-control" id="sch-notes" placeholder="Opcional..."></textarea></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-schedule">Salvar</button><button class="btn btn-outline" id="btn-cancel-schedule">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="checklist-modal">
  <div class="modal modal-lg">
    <h2 id="checklist-modal-title">üíµ Novo Registro de Trabalho</h2>
    <input type="hidden" id="cl-edit-id"/>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="cl-client"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Data</label><input type="date" class="form-control" id="cl-date"/></div>
    <div class="form-group"><label>Status</label>
      <select class="form-control" id="cl-status">
        <option value="Pendente">Pendente</option>
        <option value="Confirmado">Confirmado</option>
        <option value="Cancelado">Cancelado</option>
      </select>
    </div>
    <div class="form-group hidden" id="cl-reason-group"><label>Motivo do Cancelamento</label><textarea class="form-control" id="cl-reason"></textarea></div>
    <div class="form-group"><label>Receita (R$)</label><input type="number" class="form-control" id="cl-revenue" placeholder="0.00" step="0.01"/></div>
    <hr class="divider">
    <div style="margin-bottom:10px;font-weight:600;font-size:14px">Funcion√°rias no Trabalho</div>
    <div id="cl-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" id="btn-add-emp-row">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px"><button class="btn btn-primary" id="btn-save-worklog">Salvar</button><button class="btn btn-outline" id="btn-cancel-worklog">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="client-modal">
  <div class="modal modal-lg">
    <h2 id="client-modal-title">üë• Adicionar Cliente</h2>
    <input type="hidden" id="client-edit-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="client-name" placeholder="Nome do cliente"/></div>
    <div class="form-group"><label>Frequ√™ncia</label><select class="form-control" id="client-freq"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Valor (R$)</label><input type="number" class="form-control" id="client-price" placeholder="0.00" step="0.01"/></div>
    <div class="form-group" style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="client-transport" style="width:16px;height:16px"/><label for="client-transport" style="margin:0">Sem custo de transporte</label></div>
    <hr class="divider">
    <div style="font-weight:600;font-size:14px;margin-bottom:10px">Funcion√°rias Designadas</div>
    <div id="client-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" id="btn-add-client-emp">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px"><button class="btn btn-primary" id="btn-save-client">Salvar</button><button class="btn btn-outline" id="btn-cancel-client">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-modal">
  <div class="modal"><h2>üíº Adicionar Funcion√°rio</h2>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="emp-name" placeholder="Nome completo"/></div>
    <div class="form-group"><label>Email</label><input type="email" class="form-control" id="emp-email" placeholder="email@exemplo.com"/></div>
    <div class="form-group"><label>Senha</label><input type="password" class="form-control" id="emp-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-emp">Criar</button><button class="btn btn-outline" id="btn-cancel-emp">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="cost-modal">
  <div class="modal"><h2>üßæ Adicionar Custo</h2>
    <div class="form-group"><label>Categoria</label><select class="form-control" id="cost-cat"><option>Transporte</option><option>Produtos de Limpeza</option><option>Manuten√ß√£o</option><option>Outros</option></select></div>
    <div class="form-group"><label>Descri√ß√£o</label><input type="text" class="form-control" id="cost-desc" placeholder="Descri√ß√£o"/></div>
    <div class="form-group"><label>Valor (R$)</label><input type="number" class="form-control" id="cost-amount" placeholder="0.00" step="0.01"/></div>
    <div class="form-group"><label>Tipo</label><select class="form-control" id="cost-type"><option value="unico">√önico</option><option value="recorrente">Recorrente</option></select></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-cost">Adicionar</button><button class="btn btn-outline" id="btn-cancel-cost">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="freq-modal">
  <div class="modal">
    <h2 id="freq-modal-title">üìÜ Adicionar Frequ√™ncia</h2>
    <input type="hidden" id="freq-edit-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="freq-name" placeholder="Ex: Semanal, Quinzenal..."/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-freq">Salvar</button><button class="btn btn-outline" id="btn-cancel-freq">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="approve-modal">
  <div class="modal"><h2>‚úÖ Aprovar Usu√°rio</h2>
    <input type="hidden" id="approve-user-id"/>
    <div class="form-group"><label>Nome do Funcion√°rio</label><input type="text" class="form-control" id="approve-name" placeholder="Nome completo"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-secondary" id="btn-approve-user">Aprovar</button><button class="btn btn-outline" id="btn-cancel-approve">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="ref-modal">
  <div class="modal"><h2>üéÅ Aprovar Indica√ß√£o</h2>
    <input type="hidden" id="ref-edit-id"/>
    <div class="form-group"><label>Valor do B√¥nus (R$)</label><input type="number" class="form-control" id="ref-bonus" placeholder="0.00" step="0.01"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-secondary" id="btn-approve-ref">Aprovar com B√¥nus</button><button class="btn btn-outline" id="btn-cancel-ref">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-note-modal">
  <div class="modal"><h2>üí¨ Nova Observa√ß√£o</h2>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="note-client-sel"></select></div>
    <div class="form-group"><label>Observa√ß√£o</label><textarea class="form-control" id="note-text" rows="4" placeholder="Descreva sua observa√ß√£o..."></textarea></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-note">Enviar</button><button class="btn btn-outline" id="btn-cancel-note">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-ref-modal">
  <div class="modal"><h2>üéÅ Nova Indica√ß√£o</h2>
    <div class="form-group"><label>Nome do Cliente</label><input type="text" class="form-control" id="eref-name" placeholder="Nome completo"/></div>
    <div class="form-group"><label>Telefone</label><input type="text" class="form-control" id="eref-phone" placeholder="(11) 99999-9999"/></div>
    <div class="form-group"><label>Endere√ßo</label><input type="text" class="form-control" id="eref-address" placeholder="Rua, n√∫mero, bairro"/></div>
    <div class="form-group"><label>CEP</label><input type="text" class="form-control" id="eref-zip" placeholder="00000-000"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-emp-ref">Enviar</button><button class="btn btn-outline" id="btn-cancel-emp-ref">Cancelar</button></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const db = {
  employees:[
    {id:'e1',name:'Ana Silva',email:'ana@exemplo.com',created_at:'2025-01-10'},
    {id:'e2',name:'Maria Santos',email:'maria@exemplo.com',created_at:'2025-02-15'},
    {id:'e3',name:'Renata Oliveira',email:'renata@exemplo.com',created_at:'2025-03-20'},
  ],
  frequencies:[{id:'f1',name:'Semanal'},{id:'f2',name:'Quinzenal'},{id:'f3',name:'Mensal'},{id:'f4',name:'A cada 3 semanas'}],
  clients:[
    {id:'c1',name:'Fam√≠lia Johnson',frequency:'Semanal',price:180,no_transport_cost:false,client_employees:[{employee_id:'e1',payment_amount:60},{employee_id:'e2',payment_amount:60}]},
    {id:'c2',name:'Escrit√≥rio Tech Co',frequency:'Quinzenal',price:320,no_transport_cost:true,client_employees:[{employee_id:'e1',payment_amount:90},{employee_id:'e3',payment_amount:80}]},
    {id:'c3',name:'Sra. Williams',frequency:'Mensal',price:150,no_transport_cost:false,client_employees:[{employee_id:'e2',payment_amount:55}]},
    {id:'c4',name:'Apartamento Davis',frequency:'Quinzenal',price:200,no_transport_cost:false,client_employees:[{employee_id:'e3',payment_amount:70}]},
    {id:'c5',name:'Casa Martinez',frequency:'Semanal',price:160,no_transport_cost:false,client_employees:[{employee_id:'e1',payment_amount:50},{employee_id:'e2',payment_amount:50}]},
  ],
  costs:[
    {id:'co1',category:'Transporte',description:'Gasolina mensal',amount:150,cost_type:'recorrente',created_at:'2026-02-01'},
    {id:'co2',category:'Produtos de Limpeza',description:'Fornecedor mensal',amount:220,cost_type:'recorrente',created_at:'2026-02-01'},
    {id:'co3',category:'Manuten√ß√£o',description:'Aspirador de p√≥ novo',amount:350,cost_type:'unico',created_at:'2026-02-10'},
    {id:'co4',category:'Outros',description:'Uniformes',amount:180,cost_type:'unico',created_at:'2026-02-14'},
  ],
  workLogs:[
    {id:'w1',client_id:'c1',work_date:'2026-02-03',status:'Confirmado',revenue:180,work_log_employees:[{employee_id:'e1',payment_amount:60},{employee_id:'e2',payment_amount:60}]},
    {id:'w2',client_id:'c2',work_date:'2026-02-05',status:'Confirmado',revenue:320,work_log_employees:[{employee_id:'e1',payment_amount:90},{employee_id:'e3',payment_amount:80}]},
    {id:'w3',client_id:'c3',work_date:'2026-02-07',status:'Pendente',revenue:150,work_log_employees:[{employee_id:'e2',payment_amount:55}]},
    {id:'w4',client_id:'c4',work_date:'2026-02-10',status:'Confirmado',revenue:200,work_log_employees:[{employee_id:'e3',payment_amount:70}]},
    {id:'w5',client_id:'c1',work_date:'2026-02-10',status:'Confirmado',revenue:180,work_log_employees:[{employee_id:'e1',payment_amount:60},{employee_id:'e2',payment_amount:60}]},
    {id:'w6',client_id:'c5',work_date:'2026-02-12',status:'Cancelado',revenue:0,cancellation_reason:'Cliente desmarcou',work_log_employees:[]},
    {id:'w7',client_id:'c5',work_date:'2026-02-17',status:'Confirmado',revenue:160,work_log_employees:[{employee_id:'e1',payment_amount:50},{employee_id:'e2',payment_amount:50}]},
    {id:'w8',client_id:'c2',work_date:'2026-02-19',status:'Pendente',revenue:320,work_log_employees:[{employee_id:'e1',payment_amount:90},{employee_id:'e3',payment_amount:80}]},
  ],
  scheduleEntries:[
    {id:'s1',work_date:'2026-02-23',client_id:'c1',employee_ids:['e1','e2'],status:'confirmado',notes:''},
    {id:'s2',work_date:'2026-02-24',client_id:'c2',employee_ids:['e1','e3'],status:'confirmado',notes:''},
    {id:'s3',work_date:'2026-02-25',client_id:'c3',employee_ids:['e2'],status:'pendente',notes:'Ligar antes'},
    {id:'s4',work_date:'2026-02-26',client_id:'c5',employee_ids:['e1','e2'],status:'cancelado',notes:''},
  ],
  notifications:[
    {id:'n1',client_id:'c1',employee_id:'e1',note:'Cliente pediu produto espec√≠fico.',status:'pending',created_at:'2026-02-22T10:30:00'},
    {id:'n2',client_id:'c3',employee_id:'e2',note:'Porta do banheiro com problema.',status:'pending',created_at:'2026-02-23T14:00:00'},
    {id:'n3',client_id:'c2',employee_id:'e3',note:'Chave extra na recep√ß√£o.',status:'read',created_at:'2026-02-20T09:00:00'},
  ],
  referrals:[
    {id:'r1',employee_id:'e1',client_name:'Fam√≠lia Brown',phone:'(11) 99999-1111',address:'Rua das Flores, 123',zip_code:'01234-567',status:'pending',bonus_amount:0,created_at:'2026-02-20'},
    {id:'r2',employee_id:'e2',client_name:'Sr. Anderson',phone:'(11) 88888-2222',address:'Av. Principal, 456',zip_code:'04567-890',status:'approved',bonus_amount:50,created_at:'2026-02-15'},
    {id:'r3',employee_id:'e3',client_name:'Escrit√≥rio XYZ',phone:'(11) 77777-3333',address:'Centro, 789',zip_code:'07890-123',status:'rejected',bonus_amount:0,created_at:'2026-02-10'},
  ],
  pendingUsers:[{id:'pu1',email:'novafunc@exemplo.com',created_at:'2026-02-23T08:00:00'}],
};

const USERS={
  'adm':{role:'adm',email:'adm@wrcleaning.com',username:'Admin',password:'123456'},
  'adm@wrcleaning.com':{role:'adm',email:'adm@wrcleaning.com',username:'Admin',password:'123456'},
  'renatawaldehm@gmail.com':{role:'adm',email:'renatawaldehm@gmail.com',username:'Renata',password:'angelina123@'},
  'belami.viagens@gmail.com':{role:'colaborador',email:'belami.viagens@gmail.com',username:'Ana Silva',employeeId:'e1',password:'123456'},
  'vd273108@gmail.com':{role:'colaborador',email:'vd273108@gmail.com',username:'Maria Santos',employeeId:'e2',password:'123456'},
};

let currentUser=null,currentTab='dashboard',costsFilter='all',weekOffset=0,empWeekOffset=0,currentEmpId=null,empPeriodDates={start:'',end:''};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const fmt=v=>'R$ '+Number(v).toFixed(2);
const fmtDate=s=>{const d=new Date(s+(s.length===10?'T00:00:00':''));return d.toLocaleDateString('pt-BR')};
const uid=()=>'_'+Math.random().toString(36).substr(2,9);
const getClient=id=>db.clients.find(c=>c.id===id);
const getEmployee=id=>db.employees.find(e=>e.id===id);
const $=id=>document.getElementById(id);

function toast(msg,type='success'){
  const c=$('toast-container'),el=document.createElement('div');
  el.className=`toast ${type}`;el.innerHTML=`${type==='success'?'‚úì':'‚úï'} ${msg}`;
  c.appendChild(el);setTimeout(()=>el.remove(),3500);
}
function openModal(id){$(id).classList.remove('hidden')}
function closeModal(id){$(id).classList.add('hidden')}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.add('hidden')}));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleView(v){
  $('login-form').classList.add('hidden');
  $('register-form').classList.add('hidden');
  $('forgot-form').classList.add('hidden');
  $(v).classList.remove('hidden');
}

function doLogin(){
  const email=($('login-email').value||'').trim().toLowerCase();
  const pass=$('login-pass').value;
  const user=USERS[email];
  if(!user||user.password!==pass){toast('Email ou senha incorretos','error');return;}
  currentUser=user;
  $('login-page').classList.add('hidden');
  if(user.role==='adm'){
    $('app-page').classList.remove('hidden');
    $('header-username').textContent=user.username;
    $('header-email').textContent=user.email;
    $('profile-name').textContent=user.username;
    $('profile-email-disp').textContent=user.email;
    $('profile-avatar').textContent=user.username.charAt(0).toUpperCase();
    initApp();
  } else {
    $('emp-app-page').classList.remove('hidden');
    $('emp-header-username').textContent=user.username;
    $('emp-header-email').textContent=user.email;
    $('emp-profile-name').textContent=user.username;
    $('emp-profile-email').textContent=user.email;
    $('emp-profile-avatar').textContent=user.username.charAt(0).toUpperCase();
    const emp=db.employees.find(e=>e.id===user.employeeId);
    $('emp-header-sub').textContent=emp?emp.name:'Colaboradora';
    initEmpApp(user.employeeId);
  }
}

function doLogout(){
  currentUser=null;
  $('app-page').classList.add('hidden');
  $('emp-app-page').classList.add('hidden');
  $('login-page').classList.remove('hidden');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION (ADM) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navigate(tab){
  document.querySelectorAll('#sidebar .nav-item').forEach(b=>b.classList.remove('active'));
  document.querySelector(`#sidebar [data-tab="${tab}"]`).classList.add('active');
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  $('tab-'+tab).classList.add('active');
  currentTab=tab;
  updateNotifBadge();
  renderTab(tab);
}

function renderTab(tab){
  ({dashboard:renderDashboard,schedule:renderSchedule,checklist:renderChecklist,clients:renderClients,employees:renderEmployees,costs:renderCosts,notifications:renderNotifications,frequencies:renderFrequencies,referrals:renderReferrals}[tab]||(() => {}))();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp(){
  populateSelects();updateNotifBadge();renderDashboard();
}

function populateSelects(){
  const clientOpts='<option value="">Selecione...</option>'+db.clients.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
  $('sch-client').innerHTML=clientOpts;
  $('cl-client').innerHTML=clientOpts;
  const empOpts='<option value="">Selecione...</option>'+db.employees.map(e=>`<option value="${e.id}">${e.name}</option>`).join('');
  $('sch-emp').innerHTML=empOpts;
  $('client-freq').innerHTML='<option value="">Selecione...</option>'+db.frequencies.map(f=>`<option value="${f.name}">${f.name}</option>`).join('');
  const today=new Date().toISOString().split('T')[0];
  if(!$('sch-date').value)$('sch-date').value=today;
  if(!$('cl-date').value)$('cl-date').value=today;
}

function updateNotifBadge(){
  const p=db.notifications.filter(n=>n.status==='pending').length;
  const badge=$('notif-badge');
  const banner=$('main-notif-banner');
  if(p>0){badge.textContent=p;badge.classList.remove('hidden');if(currentTab!=='notifications'){banner.classList.remove('hidden');$('banner-title').textContent=`${p} Nova${p>1?'s':''} Notifica√ß${p>1?'√µes':'√£o'}`}}
  else{badge.classList.add('hidden');banner.classList.add('hidden')}
  const cb=$('notif-count-badge');if(cb)cb.textContent=p?`${p} pendentes`:'';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard(){
  const start=$('dash-start').value,end=$('dash-end').value;
  const filtered=db.workLogs.filter(l=>l.work_date>=start&&l.work_date<=end);
  const confirmed=filtered.filter(l=>l.status==='Confirmado');
  const totalRevenue=confirmed.reduce((s,l)=>s+l.revenue,0);
  const totalPayments=confirmed.reduce((s,l)=>s+(l.work_log_employees||[]).reduce((ps,e)=>ps+e.payment_amount,0),0);
  const startD=new Date(start+'T00:00:00'),endD=new Date(end+'T00:00:00');
  const days=Math.ceil((endD-startD)/86400000)+1;
  const recurrentTotal=db.costs.filter(c=>c.cost_type==='recorrente').reduce((s,c)=>s+c.amount,0);
  const propRecurrent=(recurrentTotal/30)*days;
  const uniqueTotal=db.costs.filter(c=>c.cost_type==='unico'&&c.created_at>=start&&c.created_at<=end).reduce((s,c)=>s+c.amount,0);
  const totalCosts=propRecurrent+uniqueTotal;
  const netProfit=totalRevenue-totalPayments-totalCosts;
  $('dash-stats').innerHTML=`
    <div class="stat-card" style="border-left:4px solid var(--primary)"><div class="stat-label">üíµ Faturamento Real</div><div class="stat-value" style="color:var(--primary)">${fmt(totalRevenue)}</div></div>
    <div class="stat-card" style="border-left:4px solid var(--destructive)"><div class="stat-label">üì§ Pagamentos Equipe</div><div class="stat-value" style="color:var(--destructive)">${fmt(totalPayments)}</div></div>
    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">üßæ Custos do Per√≠odo</div><div class="stat-value" style="color:var(--warning)">${fmt(totalCosts)}</div><div style="font-size:11px;color:var(--text-muted);margin-top:4px">Recorrente: ${fmt(propRecurrent)} | √önico: ${fmt(uniqueTotal)}<br><span style="opacity:.7">${days} dias</span></div></div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)"><div class="stat-label">üìà Lucro L√≠quido</div><div class="stat-value" style="color:var(--secondary)">${fmt(netProfit)}</div></div>`;
  $('dash-secondary').innerHTML=`
    <div class="stat-card"><div class="stat-label">üë• Total de Clientes</div><div class="stat-value">${db.clients.length}</div></div>
    <div class="stat-card"><div class="stat-label">‚úÖ Confirmados</div><div class="stat-value" style="color:var(--secondary)">${confirmed.length}</div></div>
    <div class="stat-card"><div class="stat-label">‚ùå Cancelados</div><div class="stat-value" style="color:var(--destructive)">${filtered.filter(l=>l.status==='Cancelado').length}</div></div>`;
  const ranking=db.clients.map(c=>{const lc=(c.client_employees||[]).reduce((s,ce)=>s+ce.payment_amount,0);return{...c,laborCost:lc,profit:c.price-lc}}).sort((a,b)=>b.profit-a.profit);
  $('ranking-body').innerHTML=ranking.map((c,i)=>`<tr><td>${i+1}</td><td><strong>${c.name}</strong></td><td><span class="badge badge-gray">${c.frequency}</span></td><td style="text-align:right">${fmt(c.price)}</td><td style="text-align:right">${fmt(c.laborCost)}</td><td style="text-align:right;font-weight:700;color:var(--secondary)">${fmt(c.profit)}</td></tr>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCHEDULE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getWeekStart(d){const dd=new Date(d);dd.setDate(dd.getDate()-dd.getDay());dd.setHours(0,0,0,0);return dd}

function renderSchedule(){
  const base=getWeekStart(new Date());base.setDate(base.getDate()+weekOffset*7);
  const days=[];for(let i=0;i<7;i++){const d=new Date(base);d.setDate(base.getDate()+i);days.push(d)}
  const startStr=days[0].toISOString().split('T')[0],endStr=days[6].toISOString().split('T')[0],todayStr=new Date().toISOString().split('T')[0];
  $('week-label').textContent=`${days[0].toLocaleDateString('pt-BR',{day:'2-digit',month:'short'})} ‚Äì ${days[6].toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'})}`;
  const dn=['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
  $('week-grid').innerHTML=days.map((d,i)=>{const ds=d.toISOString().split('T')[0];const entries=db.scheduleEntries.filter(e=>e.work_date===ds);return`<div class="day-col ${ds===todayStr?'today':''}"><div class="day-label">${dn[i]}</div><div class="day-num">${d.getDate()}</div>${entries.map(e=>{const cl=getClient(e.client_id);return`<div class="schedule-item ${e.status}"><div style="font-weight:600">${cl?cl.name:'?'}</div><span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}" style="font-size:10px">${e.status}</span></div>`}).join('')}</div>`}).join('');
  const weekEntries=db.scheduleEntries.filter(e=>e.work_date>=startStr&&e.work_date<=endStr).sort((a,b)=>a.work_date.localeCompare(b.work_date));
  $('schedule-list').innerHTML=weekEntries.length===0?'<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento esta semana</div>':weekEntries.map(e=>{const cl=getClient(e.client_id);const emps=(e.employee_ids||[]).map(id=>getEmployee(id)?.name||id).join(', ');return`<div class="log-row"><div class="log-info"><div class="log-date">${fmtDate(e.work_date)}</div><div class="log-client">${cl?cl.name:'?'}</div><div class="log-employees">üë§ ${emps||'Nenhuma'}</div>${e.notes?`<div style="font-size:12px;color:var(--text-muted);font-style:italic">"${e.notes}"</div>`:''}</div><div style="display:flex;align-items:center;gap:8px"><span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}">${e.status}</span><button class="btn btn-danger btn-icon btn-sm" data-del-schedule="${e.id}">üóë</button></div></div>`}).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHECKLIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderChecklist(){
  const start=$('cl-start').value,end=$('cl-end').value;
  const filtered=db.workLogs.filter(l=>l.work_date>=start&&l.work_date<=end).sort((a,b)=>b.work_date.localeCompare(a.work_date));
  const empSummary=db.employees.map(e=>{
    const total=filtered.filter(l=>l.status==='Confirmado').reduce((s,l)=>s+((l.work_log_employees||[]).find(we=>we.employee_id===e.id)?.payment_amount||0),0);
    const count=filtered.filter(l=>l.status==='Confirmado'&&(l.work_log_employees||[]).some(we=>we.employee_id===e.id)).length;
    return{...e,total,count};
  }).filter(e=>e.total>0);
  $('emp-payments-summary').innerHTML=empSummary.length===0?'<p style="color:var(--text-muted);font-size:13px">Nenhum pagamento no per√≠odo</p>':empSummary.map(e=>`<div class="summary-block"><div><div class="emp-name">${e.name}</div><div class="emp-count">${e.count} trabalho(s)</div></div><div class="emp-total">${fmt(e.total)}</div></div>`).join('');
  const confirmed=filtered.filter(l=>l.status==='Confirmado'),cancelled=filtered.filter(l=>l.status==='Cancelado'),pending=filtered.filter(l=>l.status==='Pendente');
  const totalRev=confirmed.reduce((s,l)=>s+l.revenue,0),totalPay=confirmed.reduce((s,l)=>s+(l.work_log_employees||[]).reduce((ps,e)=>ps+e.payment_amount,0),0);
  $('cl-period-stats').innerHTML=`
    <div class="summary-block"><span>Pendentes</span><span class="badge badge-pending">${pending.length}</span></div>
    <div class="summary-block"><span>Confirmados</span><span class="badge badge-secondary">${confirmed.length}</span></div>
    <div class="summary-block"><span>Cancelados</span><span class="badge badge-destructive">${cancelled.length}</span></div>
    <div class="summary-block"><span>Faturamento</span><strong style="color:var(--secondary)">${fmt(totalRev)}</strong></div>
    <div class="summary-block"><span>Pagamentos</span><strong style="color:var(--destructive)">${fmt(totalPay)}</strong></div>`;
  $('work-logs-list').innerHTML=filtered.length===0?'<div class="empty"><div class="icon">üìã</div>Nenhum registro no per√≠odo</div>':filtered.map(l=>{
    const cl=getClient(l.client_id);
    const emps=(l.work_log_employees||[]).map(we=>`${getEmployee(we.employee_id)?.name||'?'}: ${fmt(we.payment_amount)}`).join(' | ');
    const sb=l.status==='Confirmado'?'badge-secondary':l.status==='Cancelado'?'badge-destructive':'badge-pending';
    return`<div class="log-row"><div class="log-info"><div class="log-date">${fmtDate(l.work_date)}</div><div class="log-client">${cl?.name||'?'}</div>${emps?`<div class="log-employees">${emps}</div>`:''} ${l.cancellation_reason?`<div style="font-size:12px;color:var(--destructive);margin-top:2px">Cancelado: ${l.cancellation_reason}</div>`:''}</div><div style="text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:6px"><span class="badge ${sb}">${l.status}</span>${l.status==='Confirmado'?`<div class="log-revenue">${fmt(l.revenue)}</div>`:''}<div style="display:flex;gap:4px"><button class="btn btn-ghost btn-icon btn-sm" data-edit-log="${l.id}" title="Editar">‚úè</button><button class="btn btn-danger btn-icon btn-sm" data-del-log="${l.id}" title="Apagar">üóë</button></div></div></div>`;
  }).join('');
}

function openAddWorkLog(){
  $('checklist-modal-title').textContent='üíµ Novo Registro de Trabalho';
  $('cl-edit-id').value='';$('cl-client').value='';$('cl-date').value=new Date().toISOString().split('T')[0];
  $('cl-status').value='Pendente';$('cl-reason').value='';$('cl-reason-group').classList.add('hidden');
  $('cl-revenue').value='';$('cl-emp-rows').innerHTML='';openModal('checklist-modal');
}

function editWorkLog(id){
  const l=db.workLogs.find(w=>w.id===id);if(!l)return;
  $('checklist-modal-title').textContent='‚úè Editar Registro';$('cl-edit-id').value=id;
  $('cl-client').value=l.client_id;$('cl-date').value=l.work_date;$('cl-status').value=l.status;
  $('cl-reason').value=l.cancellation_reason||'';
  $('cl-reason-group').classList.toggle('hidden',l.status!=='Cancelado');
  $('cl-revenue').value=l.revenue||'';
  const c=$('cl-emp-rows');c.innerHTML='';
  (l.work_log_employees||[]).forEach(we=>{
    const div=document.createElement('div');div.style.cssText='display:flex;gap:8px;margin-bottom:8px;align-items:center';
    div.innerHTML=`<select class="form-control emp-row-emp" style="flex:1">${db.employees.map(e=>`<option value="${e.id}"${e.id===we.employee_id?' selected':''}>${e.name}</option>`).join('')}</select><input type="number" class="form-control emp-row-pay" value="${we.payment_amount}" step="0.01" style="width:100px"/><button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>`;
    c.appendChild(div);
  });openModal('checklist-modal');
}

function addEmpRow(){
  const c=$('cl-emp-rows');const div=document.createElement('div');div.style.cssText='display:flex;gap:8px;margin-bottom:8px;align-items:center';
  div.innerHTML=`<select class="form-control emp-row-emp" style="flex:1">${db.employees.map(e=>`<option value="${e.id}">${e.name}</option>`).join('')}</select><input type="number" class="form-control emp-row-pay" placeholder="R$" step="0.01" style="width:100px"/><button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>`;
  c.appendChild(div);
}

function saveWorkLog(){
  const editId=$('cl-edit-id').value,clientId=$('cl-client').value,date=$('cl-date').value,status=$('cl-status').value,reason=$('cl-reason').value,revenue=parseFloat($('cl-revenue').value)||0;
  if(!clientId||!date){toast('Preencha cliente e data','error');return;}
  const emps=[...document.querySelectorAll('#cl-emp-rows > div')].map(div=>({employee_id:div.querySelector('.emp-row-emp').value,payment_amount:parseFloat(div.querySelector('.emp-row-pay').value)||0}));
  if(editId){const l=db.workLogs.find(w=>w.id===editId);if(l){l.client_id=clientId;l.work_date=date;l.status=status;l.cancellation_reason=reason;l.revenue=status==='Confirmado'?revenue:0;l.work_log_employees=emps;}toast('Registro atualizado!','success');}
  else{db.workLogs.push({id:uid(),client_id:clientId,work_date:date,status,cancellation_reason:reason,revenue:status==='Confirmado'?revenue:0,work_log_employees:emps});toast('Registro adicionado!','success');}
  closeModal('checklist-modal');$('cl-emp-rows').innerHTML='';renderChecklist();renderDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLIENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClients(){
  $('clients-table-body').innerHTML=db.clients.map(c=>{
    const emps=(c.client_employees||[]).map(ce=>`<span class="emp-pill">${getEmployee(ce.employee_id)?.name||'?'} ${fmt(ce.payment_amount)}</span>`).join(' ');
    return`<tr><td><strong>${c.name}</strong></td><td><span class="badge badge-gray">${c.frequency}</span></td><td><strong style="color:var(--secondary)">${fmt(c.price)}</strong></td><td>${emps||'<span style="color:var(--text-muted)">Nenhuma</span>'}</td><td>${c.no_transport_cost?'<span class="badge badge-secondary">Sim</span>':'<span class="badge badge-gray">N√£o</span>'}</td><td><div style="display:flex;gap:4px"><button class="btn btn-ghost btn-icon btn-sm" data-edit-client="${c.id}">‚úè</button><button class="btn btn-danger btn-icon btn-sm" data-del-client="${c.id}">üóë</button></div></td></tr>`;
  }).join('');
}

function addClientEmpRow(empId='',pay=''){
  const c=$('client-emp-rows');const div=document.createElement('div');div.style.cssText='display:flex;gap:8px;margin-bottom:8px;align-items:center';
  div.innerHTML=`<select class="form-control cemp-row-emp" style="flex:1">${db.employees.map(e=>`<option value="${e.id}"${e.id===empId?' selected':''}>${e.name}</option>`).join('')}</select><input type="number" class="form-control cemp-row-pay" value="${pay}" placeholder="R$" step="0.01" style="width:100px"/><button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>`;
  c.appendChild(div);
}

function openAddClient(){
  $('client-modal-title').textContent='üë• Adicionar Cliente';$('client-edit-id').value='';
  $('client-name').value='';$('client-freq').value='';$('client-price').value='';$('client-transport').checked=false;$('client-emp-rows').innerHTML='';openModal('client-modal');
}

function editClient(id){
  const c=db.clients.find(cl=>cl.id===id);if(!c)return;
  $('client-modal-title').textContent='‚úè Editar Cliente';$('client-edit-id').value=id;
  $('client-name').value=c.name;$('client-freq').value=c.frequency;$('client-price').value=c.price;$('client-transport').checked=c.no_transport_cost;
  $('client-emp-rows').innerHTML='';(c.client_employees||[]).forEach(ce=>addClientEmpRow(ce.employee_id,ce.payment_amount));openModal('client-modal');
}

function saveClient(){
  const id=$('client-edit-id').value,name=$('client-name').value.trim(),freq=$('client-freq').value,price=parseFloat($('client-price').value)||0,noT=$('client-transport').checked;
  if(!name||!freq){toast('Preencha nome e frequ√™ncia','error');return;}
  const emps=[...document.querySelectorAll('#client-emp-rows > div')].map(div=>({employee_id:div.querySelector('.cemp-row-emp').value,payment_amount:parseFloat(div.querySelector('.cemp-row-pay').value)||0}));
  if(id){const c=db.clients.find(cl=>cl.id===id);if(c){c.name=name;c.frequency=freq;c.price=price;c.no_transport_cost=noT;c.client_employees=emps;}toast('Cliente atualizado!','success');}
  else{db.clients.push({id:uid(),name,frequency:freq,price,no_transport_cost:noT,client_employees:emps});toast('Cliente adicionado!','success');}
  closeModal('client-modal');renderClients();populateSelects();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EMPLOYEES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderEmployees(){
  $('emp-table-body').innerHTML=db.employees.map(e=>`<tr><td><strong>${e.name}</strong></td><td>${e.email}</td><td>${fmtDate(e.created_at)}</td><td><button class="btn btn-danger btn-icon btn-sm" data-del-emp="${e.id}">üóë</button></td></tr>`).join('');
  $('pending-list').innerHTML=db.pendingUsers.length===0?'<div class="empty"><div class="icon">‚úÖ</div>Nenhum usu√°rio pendente</div>':db.pendingUsers.map(u=>`<div class="log-row"><div class="log-info"><div class="log-client">${u.email}</div><div class="log-date">${fmtDate(u.created_at.split('T')[0])}</div></div><div style="display:flex;gap:6px"><button class="btn btn-secondary btn-sm" data-approve-user="${u.id}" data-approve-email="${u.email}">‚úÖ Aprovar</button><button class="btn btn-danger btn-sm" data-reject-user="${u.id}">‚ùå Rejeitar</button></div></div>`).join('');
}

function saveEmployee(){
  const name=$('emp-name').value.trim(),email=$('emp-email').value.trim();
  if(!name||!email){toast('Preencha nome e email','error');return;}
  db.employees.push({id:uid(),name,email,created_at:new Date().toISOString().split('T')[0]});
  closeModal('emp-modal');$('emp-name').value='';$('emp-email').value='';$('emp-pass').value='';
  toast('Funcion√°rio criado!','success');renderEmployees();populateSelects();
}

function approveUser(){
  const id=$('approve-user-id').value,name=$('approve-name').value.trim();
  if(!name){toast('Informe o nome','error');return;}
  const u=db.pendingUsers.find(p=>p.id===id);
  if(u){db.employees.push({id:uid(),name,email:u.email,created_at:new Date().toISOString().split('T')[0]});db.pendingUsers=db.pendingUsers.filter(p=>p.id!==id);}
  closeModal('approve-modal');toast('Funcion√°rio aprovado!','success');renderEmployees();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COSTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCosts(){
  const rec=db.costs.filter(c=>c.cost_type==='recorrente').reduce((s,c)=>s+c.amount,0);
  const uniq=db.costs.filter(c=>c.cost_type==='unico').reduce((s,c)=>s+c.amount,0);
  $('cost-recurrent').textContent=fmt(rec);$('cost-unique').textContent=fmt(uniq);
  const list=costsFilter==='all'?db.costs:db.costs.filter(c=>c.cost_type===costsFilter);
  $('costs-list').innerHTML=list.length===0?'<div class="empty"><div class="icon">üßæ</div>Nenhum custo encontrado</div>':list.map(c=>`<div class="cost-item"><div><div class="cost-cat">${c.category} ‚Ä¢ <span class="badge ${c.cost_type==='recorrente'?'badge-primary':'badge-warning'}">${c.cost_type}</span></div><div class="cost-desc">${c.description}</div></div><div style="display:flex;align-items:center;gap:10px"><div class="cost-amount" style="color:${c.cost_type==='recorrente'?'var(--primary)':'var(--warning)'}">${fmt(c.amount)}</div><button class="btn btn-danger btn-icon btn-sm" data-del-cost="${c.id}">üóë</button></div></div>`).join('');
}

function saveCost(){
  const cat=$('cost-cat').value,desc=$('cost-desc').value.trim(),amount=parseFloat($('cost-amount').value)||0,type=$('cost-type').value;
  if(!desc||amount<=0){toast('Preencha todos os campos','error');return;}
  db.costs.push({id:uid(),category:cat,description:desc,amount,cost_type:type,created_at:new Date().toISOString().split('T')[0]});
  closeModal('cost-modal');toast('Custo adicionado!','success');renderCosts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOTIFICATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderNotifications(){
  const pending=db.notifications.filter(n=>n.status==='pending'),read=db.notifications.filter(n=>n.status==='read');
  const html=n=>{const cl=getClient(n.client_id),emp=getEmployee(n.employee_id),d=new Date(n.created_at);return`<div class="notif-item ${n.status}"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px"><div><div style="font-weight:700">Cliente: ${cl?.name||'?'}</div><div style="font-size:13px;color:var(--primary);margin-top:2px">üë§ ${emp?.name||'?'}</div></div><div style="font-size:11px;color:var(--text-muted)">${d.toLocaleDateString('pt-BR')} ${d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</div></div><div style="background:var(--bg);border-radius:6px;padding:10px;font-size:13px;margin-bottom:10px">"${n.note}"</div><div style="display:flex;gap:6px">${n.status==='pending'?`<button class="btn btn-primary btn-sm" data-notif-read="${n.id}">‚úì Marcar como lida</button>`:''}<button class="btn btn-danger btn-sm" data-notif-del="${n.id}">üóë Excluir</button></div></div>`};
  $('notifications-list').innerHTML=(pending.length?`<h3 style="font-size:16px;font-weight:700;color:var(--destructive);margin-bottom:10px">Pendentes</h3>`+pending.map(html).join(''):'')+(read.length?`<hr class="divider"><h3 style="font-size:16px;font-weight:700;color:var(--text-muted);margin-bottom:10px">Lidas</h3>`+read.map(html).join(''):'')||'<div class="empty"><div class="icon">üîî</div>Nenhuma notifica√ß√£o</div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FREQUENCIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFrequencies(){
  $('freq-list').innerHTML=db.frequencies.length===0?'<div class="empty"><div class="icon">üìÜ</div>Nenhuma frequ√™ncia</div>':db.frequencies.map(f=>`<div class="freq-item"><span style="font-weight:600">${f.name}</span><div style="display:flex;gap:4px"><button class="btn btn-ghost btn-icon btn-sm" data-edit-freq="${f.id}">‚úè</button><button class="btn btn-danger btn-icon btn-sm" data-del-freq="${f.id}">üóë</button></div></div>`).join('');
}

function saveFreq(){
  const id=$('freq-edit-id').value,name=$('freq-name').value.trim();
  if(!name){toast('Digite o nome','error');return;}
  if(id){const f=db.frequencies.find(f=>f.id===id);if(f)f.name=name;toast('Frequ√™ncia atualizada!','success');}
  else{db.frequencies.push({id:uid(),name});toast('Frequ√™ncia adicionada!','success');}
  closeModal('freq-modal');$('freq-edit-id').value='';$('freq-name').value='';renderFrequencies();populateSelects();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REFERRALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReferrals(){
  const pending=db.referrals.filter(r=>r.status==='pending'),approved=db.referrals.filter(r=>r.status==='approved'),rejected=db.referrals.filter(r=>r.status==='rejected');
  $('referral-stats').innerHTML=`
    <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">‚è≥ Pendentes</div><div class="stat-value">${pending.length}</div></div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)"><div class="stat-label">‚úÖ Aprovadas</div><div class="stat-value" style="color:var(--secondary)">${approved.length}</div></div>
    <div class="stat-card" style="border-left:4px solid var(--destructive)"><div class="stat-label">‚ùå Rejeitadas</div><div class="stat-value" style="color:var(--destructive)">${rejected.length}</div></div>`;
  const refHtml=r=>{const emp=getEmployee(r.employee_id);return`<div class="referral-item ${r.status}" style="margin-bottom:8px"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px"><div><div style="font-weight:700;font-size:15px">${r.client_name}</div><div style="font-size:12px;color:var(--text-muted)">üë§ ${emp?.name||'?'}</div></div><div style="display:flex;align-items:center;gap:6px"><span class="badge ${r.status==='pending'?'badge-warning':r.status==='approved'?'badge-secondary':'badge-destructive'}">${r.status==='pending'?'Pendente':r.status==='approved'?'Aprovado':'Rejeitado'}</span><button class="btn btn-danger btn-icon btn-sm" data-del-ref="${r.id}">üóë</button></div></div><div style="font-size:12px;color:var(--text-muted);margin-bottom:8px">üìû ${r.phone} | üìç ${r.address} | üìÆ ${r.zip_code}</div>${r.bonus_amount>0?`<div style="font-size:13px;font-weight:600;color:var(--secondary);margin-bottom:8px">üéÅ B√¥nus: ${fmt(r.bonus_amount)}</div>`:''}<div style="display:flex;gap:6px;flex-wrap:wrap">${r.status==='pending'?`<button class="btn btn-secondary btn-sm" data-approve-ref="${r.id}">‚úÖ Aprovar</button><button class="btn btn-danger btn-sm" data-reject-ref="${r.id}">‚ùå Rejeitar</button>`:''}${r.status==='approved'?`<button class="btn btn-outline btn-sm" data-pending-ref="${r.id}">‚Ü© Pendente</button><button class="btn btn-danger btn-sm" data-reject-ref="${r.id}">‚ùå Rejeitar</button>`:''}${r.status==='rejected'?`<button class="btn btn-outline btn-sm" data-pending-ref="${r.id}">‚Ü© Pendente</button><button class="btn btn-secondary btn-sm" data-approve-ref="${r.id}">‚úÖ Aprovar</button>`:''}</div></div>`};
  $('referrals-list').innerHTML=(pending.length?`<h3 style="font-weight:700;margin-bottom:10px;color:var(--warning)">Pendentes</h3>`+pending.map(refHtml).join(''):'')+(approved.length?`<h3 style="font-weight:700;margin:16px 0 10px;color:var(--secondary)">Aprovadas</h3>`+approved.map(refHtml).join(''):'')+(rejected.length?`<h3 style="font-weight:700;margin:16px 0 10px;color:var(--destructive)">Rejeitadas</h3>`+rejected.map(refHtml).join(''):'')||'<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o</div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EMPLOYEE APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initEmpApp(empId){
  currentEmpId=empId;setEmpPeriod('mes',null);
  const myClients=db.clients.filter(c=>(c.client_employees||[]).some(ce=>ce.employee_id===empId));
  $('note-client-sel').innerHTML=myClients.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
  renderEmpGanhos();renderEmpAgenda();renderEmpClients();renderEmpReferrals();
}

function empNavigate(tab){
  document.querySelectorAll('.emp-tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.emp-tab-btn[data-etab="${tab}"]`).classList.add('active');
  document.querySelectorAll('#emp-app-page .tab-content').forEach(t=>t.classList.remove('active'));
  $('tab-'+tab).classList.add('active');
}

function setEmpPeriod(period,btn){
  const now=new Date();
  if(btn){document.querySelectorAll('#tab-emp-ganhos .btn').forEach(b=>{b.className=b.className.replace('btn-primary','btn-outline')});btn.className=btn.className.replace('btn-outline','btn-primary')}
  if(period==='semana'){const ws=new Date(now);ws.setDate(now.getDate()-now.getDay());const we=new Date(ws);we.setDate(ws.getDate()+6);empPeriodDates={start:ws.toISOString().split('T')[0],end:we.toISOString().split('T')[0]};}
  else if(period==='mes'){empPeriodDates={start:new Date(now.getFullYear(),now.getMonth(),1).toISOString().split('T')[0],end:new Date(now.getFullYear(),now.getMonth()+1,0).toISOString().split('T')[0]};}
  else{empPeriodDates={start:new Date(now.getFullYear(),0,1).toISOString().split('T')[0],end:new Date(now.getFullYear(),11,31).toISOString().split('T')[0]};}
  renderEmpGanhos();
}

function renderEmpGanhos(){
  const{start,end}=empPeriodDates,empId=currentEmpId;
  const myLogs=db.workLogs.filter(l=>l.work_date>=start&&l.work_date<=end&&l.status==='Confirmado'&&(l.work_log_employees||[]).some(we=>we.employee_id===empId));
  const myEarnings=myLogs.reduce((s,l)=>s+((l.work_log_employees||[]).find(we=>we.employee_id===empId)?.payment_amount||0),0);
  const myBonuses=db.referrals.filter(r=>r.employee_id===empId&&r.status==='approved').reduce((s,r)=>s+r.bonus_amount,0);
  $('emp-stats').innerHTML=`<div class="stat-card" style="border-left:4px solid var(--primary)"><div class="stat-label">üíµ Meus Ganhos</div><div class="stat-value" style="color:var(--primary)">${fmt(myEarnings)}</div></div><div class="stat-card" style="border-left:4px solid var(--secondary)"><div class="stat-label">üéÅ B√¥nus de Indica√ß√µes</div><div class="stat-value" style="color:var(--secondary)">${fmt(myBonuses)}</div></div><div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">üìÖ Trabalhos</div><div class="stat-value" style="color:var(--warning)">${myLogs.length}</div></div>`;
  $('emp-work-list').innerHTML=myLogs.length===0?'<div class="empty"><div class="icon">üíµ</div>Nenhum trabalho no per√≠odo</div>':myLogs.sort((a,b)=>b.work_date.localeCompare(a.work_date)).map(l=>{const cl=getClient(l.client_id),we=(l.work_log_employees||[]).find(we=>we.employee_id===empId);return`<div class="log-row"><div class="log-info"><div class="log-date">${fmtDate(l.work_date)}</div><div class="log-client">${cl?.name||'?'}</div><div class="log-employees">${cl?.frequency||''}</div></div><div class="log-revenue">${fmt(we?.payment_amount||0)}</div></div>`}).join('');
}

function renderEmpAgenda(){
  const base=getWeekStart(new Date());base.setDate(base.getDate()+empWeekOffset*7);
  const days=[];for(let i=0;i<7;i++){const d=new Date(base);d.setDate(base.getDate()+i);days.push(d)}
  const startStr=days[0].toISOString().split('T')[0],endStr=days[6].toISOString().split('T')[0],todayStr=new Date().toISOString().split('T')[0],dn=['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
  $('emp-week-label').textContent=`${days[0].toLocaleDateString('pt-BR',{day:'2-digit',month:'short'})} ‚Äì ${days[6].toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'})}`;
  const myEntries=db.scheduleEntries.filter(e=>(e.employee_ids||[]).includes(currentEmpId)&&e.work_date>=startStr&&e.work_date<=endStr);
  $('emp-week-grid').innerHTML=days.map((d,i)=>{const ds=d.toISOString().split('T')[0];const de=myEntries.filter(e=>e.work_date===ds);return`<div class="day-col ${ds===todayStr?'today':''}"><div class="day-label">${dn[i]}</div><div class="day-num">${d.getDate()}</div>${de.map(e=>{const cl=getClient(e.client_id);return`<div class="schedule-item ${e.status}"><div style="font-weight:600">${cl?.name||'?'}</div><span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}" style="font-size:10px">${e.status}</span></div>`}).join('')}</div>`}).join('');
  $('emp-schedule-list').innerHTML=myEntries.length===0?'<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento esta semana para voc√™</div>':myEntries.sort((a,b)=>a.work_date.localeCompare(b.work_date)).map(e=>{const cl=getClient(e.client_id);return`<div class="log-row"><div class="log-info"><div class="log-date">${fmtDate(e.work_date)}</div><div class="log-client">${cl?.name||'?'}</div>${e.notes?`<div style="font-size:12px;color:var(--text-muted);font-style:italic">"${e.notes}"</div>`:''}</div><span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}">${e.status}</span></div>`}).join('');
}

function renderEmpClients(){
  const empId=currentEmpId,myClients=db.clients.filter(c=>(c.client_employees||[]).some(ce=>ce.employee_id===empId));
  $('emp-clients-list').innerHTML=myClients.length===0?'<div class="empty"><div class="icon">üë•</div>Nenhum cliente designado</div>':myClients.map(c=>{const ce=(c.client_employees||[]).find(ce=>ce.employee_id===empId);return`<div class="log-row" style="margin-bottom:8px"><div class="log-info"><div class="log-client">${c.name}</div><div class="log-employees">${c.frequency}</div></div><div style="text-align:right"><div style="font-size:12px;color:var(--text-muted)">Meu pagamento</div><div style="font-weight:700;color:var(--primary)">${fmt(ce?.payment_amount||0)}</div></div></div>`}).join('');
  const myNotes=db.notifications.filter(n=>n.employee_id===empId);
  $('emp-notes-list').innerHTML=myNotes.length===0?'<p style="color:var(--text-muted);font-size:13px;padding:8px 0">Nenhuma observa√ß√£o enviada ainda</p>':myNotes.map(n=>{const cl=getClient(n.client_id);return`<div style="border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:6px"><strong>${cl?.name||'?'}</strong><span class="badge ${n.status==='pending'?'badge-warning':'badge-secondary'}">${n.status==='pending'?'Pendente':'Lida'}</span></div><div style="font-size:13px;color:var(--text-muted)">"${n.note}"</div></div>`}).join('');
}

function renderEmpReferrals(){
  const empId=currentEmpId,myRefs=db.referrals.filter(r=>r.employee_id===empId);
  const ap=myRefs.filter(r=>r.status==='approved'),tb=ap.reduce((s,r)=>s+r.bonus_amount,0);
  $('emp-referrals-stats').innerHTML=`<div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">‚è≥ Pendentes</div><div class="stat-value">${myRefs.filter(r=>r.status==='pending').length}</div></div><div class="stat-card" style="border-left:4px solid var(--secondary)"><div class="stat-label">‚úÖ Aprovadas</div><div class="stat-value" style="color:var(--secondary)">${ap.length}</div></div><div class="stat-card" style="border-left:4px solid var(--primary)"><div class="stat-label">üéÅ Total B√¥nus</div><div class="stat-value" style="color:var(--primary)">${fmt(tb)}</div></div>`;
  $('emp-referrals-list').innerHTML=myRefs.length===0?'<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o ainda</div>':myRefs.map(r=>`<div class="referral-item ${r.status}" style="margin-bottom:8px"><div style="display:flex;justify-content:space-between;align-items:start"><div><div style="font-weight:700">${r.client_name}</div><div style="font-size:12px;color:var(--text-muted)">üìû ${r.phone} | üìç ${r.address}</div></div><span class="badge ${r.status==='pending'?'badge-warning':r.status==='approved'?'badge-secondary':'badge-destructive'}">${r.status==='pending'?'Pendente':r.status==='approved'?'Aprovado':'Rejeitado'}</span></div>${r.bonus_amount>0?`<div style="margin-top:8px;font-weight:700;color:var(--secondary)">üéÅ B√¥nus: ${fmt(r.bonus_amount)}</div>`:''}</div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EVENT LISTENERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded',()=>{
  // Login
  $('btn-login').addEventListener('click',doLogin);
  $('login-pass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin()});
  $('btn-to-forgot').addEventListener('click',()=>toggleView('forgot-form'));
  $('btn-to-register').addEventListener('click',()=>toggleView('register-form'));
  $('btn-reg-back').addEventListener('click',()=>toggleView('login-form'));
  $('btn-forgot-back').addEventListener('click',()=>toggleView('login-form'));
  $('btn-send-otp').addEventListener('click',()=>toast('C√≥digo enviado!','success'));
  $('btn-send-forgot').addEventListener('click',()=>toast('C√≥digo enviado!','success'));
  $('btn-logout-adm').addEventListener('click',doLogout);
  $('btn-logout-emp').addEventListener('click',doLogout);

  // Sidebar
  $('menu-toggle').addEventListener('click',()=>{$('sidebar').classList.toggle('open');$('sidebar-overlay').classList.toggle('open')});
  $('sidebar-overlay').addEventListener('click',()=>{$('sidebar').classList.remove('open');$('sidebar-overlay').classList.remove('open')});

  // ADM nav
  document.querySelectorAll('#sidebar .nav-item').forEach(btn=>{
    btn.addEventListener('click',()=>{navigate(btn.dataset.tab);$('sidebar').classList.remove('open');$('sidebar-overlay').classList.remove('open')});
  });

  // Banner
  $('btn-banner-ver').addEventListener('click',()=>navigate('notifications'));

  // Dashboard filters
  $('dash-month').addEventListener('change',()=>{const[y,m]=$('dash-month').value.split('-');$('dash-start').value=new Date(+y,+m-1,1).toISOString().split('T')[0];$('dash-end').value=new Date(+y,+m,0).toISOString().split('T')[0];renderDashboard()});
  $('dash-start').addEventListener('change',renderDashboard);
  $('dash-end').addEventListener('change',renderDashboard);

  // Schedule
  $('prev-week').addEventListener('click',()=>{weekOffset--;renderSchedule()});
  $('next-week').addEventListener('click',()=>{weekOffset++;renderSchedule()});
  $('btn-add-schedule').addEventListener('click',()=>openModal('schedule-modal'));
  $('btn-save-schedule').addEventListener('click',()=>{
    const date=$('sch-date').value,clientId=$('sch-client').value,empId=$('sch-emp').value,status=$('sch-status').value,notes=$('sch-notes').value;
    if(!date||!clientId){toast('Preencha data e cliente','error');return;}
    db.scheduleEntries.push({id:uid(),work_date:date,client_id:clientId,employee_ids:empId?[empId]:[],status,notes});
    closeModal('schedule-modal');toast('Agendamento criado!','success');renderSchedule();
  });
  $('btn-cancel-schedule').addEventListener('click',()=>closeModal('schedule-modal'));

  // Checklist
  $('btn-add-worklog').addEventListener('click',openAddWorkLog);
  $('btn-save-worklog').addEventListener('click',saveWorkLog);
  $('btn-cancel-worklog').addEventListener('click',()=>closeModal('checklist-modal'));
  $('btn-add-emp-row').addEventListener('click',addEmpRow);
  $('cl-status').addEventListener('change',function(){$('cl-reason-group').classList.toggle('hidden',this.value!=='Cancelado')});
  $('cl-month').addEventListener('change',()=>{const[y,m]=$('cl-month').value.split('-');$('cl-start').value=new Date(+y,+m-1,1).toISOString().split('T')[0];$('cl-end').value=new Date(+y,+m,0).toISOString().split('T')[0];renderChecklist()});
  $('cl-start').addEventListener('change',renderChecklist);
  $('cl-end').addEventListener('change',renderChecklist);

  // Clients
  $('btn-add-client').addEventListener('click',openAddClient);
  $('btn-save-client').addEventListener('click',saveClient);
  $('btn-cancel-client').addEventListener('click',()=>closeModal('client-modal'));
  $('btn-add-client-emp').addEventListener('click',()=>addClientEmpRow());

  // Employees
  $('btn-add-emp').addEventListener('click',()=>openModal('emp-modal'));
  $('btn-save-emp').addEventListener('click',saveEmployee);
  $('btn-cancel-emp').addEventListener('click',()=>closeModal('emp-modal'));
  $('emp-tab-active').addEventListener('click',()=>{$('emp-tab-active').classList.add('active');$('emp-tab-pending').classList.remove('active');$('active-emps').classList.remove('hidden');$('pending-users').classList.add('hidden')});
  $('emp-tab-pending').addEventListener('click',()=>{$('emp-tab-pending').classList.add('active');$('emp-tab-active').classList.remove('active');$('pending-users').classList.remove('hidden');$('active-emps').classList.add('hidden')});
  $('btn-approve-user').addEventListener('click',approveUser);
  $('btn-cancel-approve').addEventListener('click',()=>closeModal('approve-modal'));

  // Costs
  $('btn-add-cost').addEventListener('click',()=>openModal('cost-modal'));
  $('btn-save-cost').addEventListener('click',saveCost);
  $('btn-cancel-cost').addEventListener('click',()=>closeModal('cost-modal'));
  $('filter-all').addEventListener('click',()=>{costsFilter='all';renderCosts()});
  $('filter-recorrente').addEventListener('click',()=>{costsFilter='recorrente';renderCosts()});
  $('filter-unico').addEventListener('click',()=>{costsFilter='unico';renderCosts()});

  // Frequencies
  $('btn-add-freq').addEventListener('click',()=>{$('freq-modal-title').textContent='üìÜ Adicionar Frequ√™ncia';$('freq-edit-id').value='';$('freq-name').value='';openModal('freq-modal')});
  $('btn-save-freq').addEventListener('click',saveFreq);
  $('btn-cancel-freq').addEventListener('click',()=>closeModal('freq-modal'));

  // Referrals
  $('btn-approve-ref').addEventListener('click',()=>{
    const id=$('ref-edit-id').value,bonus=parseFloat($('ref-bonus').value)||0;
    if(bonus<=0){toast('Informe um valor de b√¥nus v√°lido','error');return;}
    const r=db.referrals.find(r=>r.id===id);if(r){r.status='approved';r.bonus_amount=bonus;}
    closeModal('ref-modal');toast('Indica√ß√£o aprovada!','success');renderReferrals();
  });
  $('btn-cancel-ref').addEventListener('click',()=>closeModal('ref-modal'));

  // Profile
  $('btn-save-profile').addEventListener('click',()=>toast('Perfil atualizado!','success'));

  // Employee app
  document.querySelectorAll('.emp-tab-btn').forEach(btn=>btn.addEventListener('click',()=>empNavigate(btn.dataset.etab)));
  document.querySelectorAll('[data-period]').forEach(btn=>btn.addEventListener('click',()=>setEmpPeriod(btn.dataset.period,btn)));
  $('emp-prev-week').addEventListener('click',()=>{empWeekOffset--;renderEmpAgenda()});
  $('emp-next-week').addEventListener('click',()=>{empWeekOffset++;renderEmpAgenda()});
  $('btn-emp-note').addEventListener('click',()=>openModal('emp-note-modal'));
  $('btn-save-note').addEventListener('click',()=>{
    const clientId=$('note-client-sel').value,note=$('note-text').value.trim();
    if(!note){toast('Escreva sua observa√ß√£o','error');return;}
    db.notifications.push({id:uid(),client_id:clientId,employee_id:currentEmpId,note,status:'pending',created_at:new Date().toISOString()});
    $('note-text').value='';closeModal('emp-note-modal');toast('Observa√ß√£o enviada!','success');renderEmpClients();
  });
  $('btn-cancel-note').addEventListener('click',()=>closeModal('emp-note-modal'));
  $('btn-emp-ref').addEventListener('click',()=>openModal('emp-ref-modal'));
  $('btn-save-emp-ref').addEventListener('click',()=>{
    const name=$('eref-name').value.trim(),phone=$('eref-phone').value.trim(),address=$('eref-address').value.trim(),zip=$('eref-zip').value.trim();
    if(!name||!phone||!address||!zip){toast('Preencha todos os campos','error');return;}
    db.referrals.push({id:uid(),employee_id:currentEmpId,client_name:name,phone,address,zip_code:zip,status:'pending',bonus_amount:0,created_at:new Date().toISOString().split('T')[0]});
    $('eref-name').value='';$('eref-phone').value='';$('eref-address').value='';$('eref-zip').value='';
    closeModal('emp-ref-modal');toast('Indica√ß√£o enviada!','success');renderEmpReferrals();
  });
  $('btn-cancel-emp-ref').addEventListener('click',()=>closeModal('emp-ref-modal'));
  $('btn-save-emp-profile').addEventListener('click',()=>toast('Senha atualizada!','success'));

  // Delegated clicks (dynamic content)
  document.addEventListener('click',e=>{
    // Schedule delete
    const ds=e.target.dataset.delSchedule;
    if(ds){if(!confirm('Remover agendamento?'))return;db.scheduleEntries=db.scheduleEntries.filter(s=>s.id!==ds);toast('Agendamento removido','success');renderSchedule();return;}
    // Work log edit/delete
    const el=e.target.dataset.editLog;if(el){editWorkLog(el);return;}
    const dl=e.target.dataset.delLog;if(dl){if(!confirm('Remover registro?'))return;db.workLogs=db.workLogs.filter(l=>l.id!==dl);toast('Registro removido','success');renderChecklist();renderDashboard();return;}
    // Client edit/delete
    const ec=e.target.dataset.editClient;if(ec){editClient(ec);return;}
    const dc=e.target.dataset.delClient;if(dc){if(!confirm('Remover cliente?'))return;db.clients=db.clients.filter(c=>c.id!==dc);toast('Cliente removido','success');renderClients();return;}
    // Employee delete
    const de=e.target.dataset.delEmp;if(de){if(!confirm('Remover funcion√°rio?'))return;db.employees=db.employees.filter(e=>e.id!==de);toast('Funcion√°rio removido','success');renderEmployees();return;}
    // Pending user approve/reject
    const au=e.target.dataset.approveUser;if(au){$('approve-user-id').value=au;$('approve-name').value=(e.target.dataset.approveEmail||'').split('@')[0];openModal('approve-modal');return;}
    const ru=e.target.dataset.rejectUser;if(ru){if(!confirm('Rejeitar usu√°rio?'))return;db.pendingUsers=db.pendingUsers.filter(p=>p.id!==ru);toast('Usu√°rio rejeitado','success');renderEmployees();return;}
    // Cost delete
    const dco=e.target.dataset.delCost;if(dco){if(!confirm('Remover custo?'))return;db.costs=db.costs.filter(c=>c.id!==dco);toast('Custo removido','success');renderCosts();return;}
    // Notifications
    const nr=e.target.dataset.notifRead;if(nr){const n=db.notifications.find(n=>n.id===nr);if(n)n.status='read';toast('Notifica√ß√£o marcada como lida','success');updateNotifBadge();renderNotifications();return;}
    const nd=e.target.dataset.notifDel;if(nd){if(!confirm('Excluir notifica√ß√£o?'))return;db.notifications=db.notifications.filter(n=>n.id!==nd);toast('Notifica√ß√£o exclu√≠da','success');updateNotifBadge();renderNotifications();return;}
    // Frequencies
    const ef=e.target.dataset.editFreq;if(ef){const f=db.frequencies.find(f=>f.id===ef);if(f){$('freq-modal-title').textContent='‚úè Editar Frequ√™ncia';$('freq-edit-id').value=ef;$('freq-name').value=f.name;openModal('freq-modal');}return;}
    const df=e.target.dataset.delFreq;if(df){if(!confirm('Remover frequ√™ncia?'))return;db.frequencies=db.frequencies.filter(f=>f.id!==df);toast('Frequ√™ncia removida','success');renderFrequencies();return;}
    // Referrals
    const ar=e.target.dataset.approveRef;if(ar){$('ref-edit-id').value=ar;$('ref-bonus').value='';openModal('ref-modal');return;}
    const rr=e.target.dataset.rejectRef;if(rr){if(!confirm('Rejeitar indica√ß√£o?'))return;const r=db.referrals.find(r=>r.id===rr);if(r)r.status='rejected';toast('Indica√ß√£o rejeitada','success');renderReferrals();return;}
    const pr=e.target.dataset.pendingRef;if(pr){const r=db.referrals.find(r=>r.id===pr);if(r){r.status='pending';r.bonus_amount=0;}toast('Voltou para Pendente','success');renderReferrals();return;}
    const dr=e.target.dataset.delRef;if(dr){if(!confirm('Apagar indica√ß√£o?'))return;db.referrals=db.referrals.filter(r=>r.id!==dr);toast('Indica√ß√£o apagada','success');renderReferrals();return;}
  });
});
</script>
</body>
</html>
