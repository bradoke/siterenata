<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>WR Cleaning Service</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #2563eb;
    --primary-light: #dbeafe;
    --primary-dark: #1d4ed8;
    --secondary: #10b981;
    --secondary-light: #d1fae5;
    --destructive: #ef4444;
    --destructive-light: #fee2e2;
    --warning: #f97316;
    --warning-light: #ffedd5;
    --bg: #f8fafc;
    --card: #ffffff;
    --border: #e2e8f0;
    --text: #0f172a;
    --text-muted: #64748b;
    --sidebar-w: 240px;
    --header-h: 64px;
    --radius: 10px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
  a { color: inherit; text-decoration: none; }
  button { cursor: pointer; font-family: inherit; border: none; background: none; }
  input, select, textarea { font-family: inherit; }

  /* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
  .hidden { display: none !important; }
  .flex { display: flex; }
  .items-center { align-items: center; }
  .justify-between { justify-content: space-between; }
  .gap-2 { gap: 8px; }
  .gap-3 { gap: 12px; }
  .gap-4 { gap: 16px; }
  .mt-1 { margin-top: 4px; }
  .mt-2 { margin-top: 8px; }
  .mt-4 { margin-top: 16px; }
  .mb-2 { margin-bottom: 8px; }
  .mb-4 { margin-bottom: 16px; }
  .w-full { width: 100%; }
  .text-sm { font-size: 13px; }
  .text-xs { font-size: 11px; }
  .font-bold { font-weight: 700; }
  .font-medium { font-weight: 500; }
  .text-muted { color: var(--text-muted); }
  .text-primary { color: var(--primary); }
  .text-secondary { color: var(--secondary); }
  .text-destructive { color: var(--destructive); }
  .text-right { text-align: right; }
  .text-center { text-align: center; }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  #toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
  .toast { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px 16px; font-size: 13px; font-weight: 500; box-shadow: 0 8px 24px rgba(0,0,0,.12); min-width: 260px; display: flex; align-items: center; gap: 8px; animation: slideIn .25s ease; }
  .toast.success { border-left: 4px solid var(--secondary); }
  .toast.error { border-left: 4px solid var(--destructive); }
  @keyframes slideIn { from { transform: translateX(60px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 16px; animation: fadeIn .15s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .modal { background: var(--card); border-radius: 14px; padding: 28px; width: 100%; max-width: 460px; max-height: 90vh; overflow-y: auto; box-shadow: 0 24px 64px rgba(0,0,0,.18); }
  .modal h2 { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
  .modal-lg { max-width: 600px; }

  /* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
  .form-group { margin-bottom: 14px; }
  .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 5px; }
  .form-control { width: 100%; padding: 9px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14px; outline: none; transition: border-color .15s; background: #fff; }
  .form-control:focus { border-color: var(--primary); }
  select.form-control { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
  textarea.form-control { resize: vertical; min-height: 80px; }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 9px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; transition: all .15s; cursor: pointer; }
  .btn-primary { background: var(--primary); color: #fff; border: 1.5px solid var(--primary); }
  .btn-primary:hover { background: var(--primary-dark); }
  .btn-secondary { background: var(--secondary); color: #fff; border: 1.5px solid var(--secondary); }
  .btn-outline { background: transparent; color: var(--text); border: 1.5px solid var(--border); }
  .btn-outline:hover { background: var(--bg); }
  .btn-ghost { background: transparent; color: var(--text-muted); border: 1.5px solid transparent; padding: 6px 10px; }
  .btn-ghost:hover { background: var(--bg); color: var(--text); }
  .btn-danger { background: var(--destructive-light); color: var(--destructive); border: 1.5px solid transparent; }
  .btn-danger:hover { background: var(--destructive); color: #fff; }
  .btn-sm { padding: 6px 12px; font-size: 12px; }
  .btn-icon { padding: 7px; border-radius: 7px; }
  .btn-full { width: 100%; }

  /* ‚îÄ‚îÄ BADGE ‚îÄ‚îÄ */
  .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 99px; font-size: 11px; font-weight: 600; }
  .badge-primary { background: var(--primary-light); color: var(--primary); }
  .badge-secondary { background: var(--secondary-light); color: var(--secondary); }
  .badge-destructive { background: var(--destructive-light); color: var(--destructive); }
  .badge-warning { background: var(--warning-light); color: var(--warning); }
  .badge-gray { background: #f1f5f9; color: var(--text-muted); }
  .badge-pending { background: var(--primary-light); color: var(--primary); }

  /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
  .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); }
  .card-header { padding: 16px 20px 8px; border-bottom: 1px solid var(--border); }
  .card-header h3 { font-size: 15px; font-weight: 700; }
  .card-body { padding: 16px 20px; }
  .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px 20px; }
  .stat-card .stat-label { font-size: 12px; font-weight: 500; color: var(--text-muted); margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
  .stat-card .stat-value { font-size: 26px; font-weight: 700; }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .table th { text-align: left; padding: 10px 12px; font-weight: 600; border-bottom: 2px solid var(--border); color: var(--text-muted); font-size: 12px; }
  .table td { padding: 10px 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
  .table tr:last-child td { border-bottom: none; }
  .table tr:hover td { background: var(--bg); }
  .table-responsive { overflow-x: auto; }

  /* ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ */
  #login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary-light) 0%, #fff 50%, var(--secondary-light) 100%); padding: 20px; }
  .login-card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 40px; width: 100%; max-width: 420px; box-shadow: 0 20px 60px rgba(37,99,235,.1); }
  .login-logo { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 28px; }
  .login-logo .spark { color: var(--primary); font-size: 36px; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.6} }
  .login-logo h1 { font-size: 22px; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-align: center; }
  .login-logo p { font-size: 13px; color: var(--text-muted); }
  .login-switch { text-align: center; font-size: 13px; color: var(--text-muted); margin-top: 12px; }
  .login-switch button { color: var(--primary); font-weight: 600; background: none; border: none; cursor: pointer; }
  .login-switch button:hover { text-decoration: underline; }

  /* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
  #app-page { display: flex; flex-direction: column; min-height: 100vh; }
  .app-header { height: var(--header-h); background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 1px 4px rgba(0,0,0,.06); }
  .header-logo { display: flex; align-items: center; gap: 10px; }
  .header-logo .spark { color: var(--primary); font-size: 22px; }
  .header-logo h2 { font-size: 16px; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .header-logo span { font-size: 10px; color: var(--text-muted); display: block; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .user-info { text-align: right; }
  .user-info .name { font-size: 13px; font-weight: 600; }
  .user-info .email { font-size: 11px; color: var(--text-muted); }

  .app-body { display: flex; flex: 1; }
  .sidebar { width: var(--sidebar-w); background: var(--card); border-right: 1px solid var(--border); padding: 12px 10px; position: sticky; top: var(--header-h); height: calc(100vh - var(--header-h)); overflow-y: auto; flex-shrink: 0; }
  .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; transition: all .15s; width: 100%; position: relative; }
  .nav-item:hover { background: var(--bg); color: var(--text); }
  .nav-item.active { background: var(--primary); color: #fff; }
  .nav-item .icon { font-size: 16px; flex-shrink: 0; }
  .nav-badge { margin-left: auto; background: var(--destructive); color: #fff; font-size: 10px; font-weight: 700; border-radius: 99px; min-width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; padding: 0 4px; }

  .main-content { flex: 1; padding: 24px; overflow-x: hidden; }

  /* ‚îÄ‚îÄ TABS (page sections) ‚îÄ‚îÄ */
  .tab-content { display: none; animation: fadeUp .2s ease; }
  .tab-content.active { display: block; }
  @keyframes fadeUp { from { transform: translateY(8px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

  /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
  .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
  .page-header h2 { font-size: 22px; font-weight: 800; }

  /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }

  /* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
  .divider { border: none; border-top: 1px solid var(--border); margin: 16px 0; }

  /* ‚îÄ‚îÄ NOTIFICATION BANNER ‚îÄ‚îÄ */
  .notif-banner { background: var(--destructive-light); border: 1px solid #fca5a5; border-radius: var(--radius); padding: 14px 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
  .notif-banner .icon { color: var(--destructive); font-size: 18px; }
  .notif-banner .title { font-weight: 700; color: var(--destructive); font-size: 14px; }
  .notif-banner .desc { font-size: 12px; color: var(--text-muted); }

  /* ‚îÄ‚îÄ EMPLOYEE PILLS ‚îÄ‚îÄ */
  .emp-pill { display: inline-flex; align-items: center; gap: 6px; background: var(--primary-light); color: var(--primary); border-radius: 99px; padding: 3px 10px; font-size: 12px; font-weight: 500; }

  /* ‚îÄ‚îÄ CHECKLIST ROW ‚îÄ‚îÄ */
  .log-row { border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; margin-bottom: 8px; display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; }
  .log-row:hover { border-color: var(--primary); }
  .log-row .log-info { flex: 1; }
  .log-row .log-date { font-size: 12px; color: var(--text-muted); }
  .log-row .log-client { font-size: 14px; font-weight: 600; }
  .log-row .log-employees { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
  .log-row .log-revenue { font-size: 16px; font-weight: 700; color: var(--secondary); }

  /* ‚îÄ‚îÄ SCHEDULE WEEK ‚îÄ‚îÄ */
  .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
  .day-col { border: 1px solid var(--border); border-radius: 8px; min-height: 100px; padding: 8px; }
  .day-col .day-label { font-size: 11px; font-weight: 700; text-align: center; color: var(--text-muted); margin-bottom: 6px; }
  .day-col .day-num { font-size: 16px; font-weight: 700; text-align: center; margin-bottom: 8px; }
  .day-col.today { border-color: var(--primary); background: var(--primary-light); }
  .schedule-item { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 6px 8px; font-size: 11px; margin-bottom: 4px; }
  .schedule-item.confirmado { border-left: 3px solid var(--secondary); }
  .schedule-item.pendente { border-left: 3px solid var(--warning); }
  .schedule-item.cancelado { border-left: 3px solid var(--destructive); opacity: .7; }

  /* ‚îÄ‚îÄ COST ITEM ‚îÄ‚îÄ */
  .cost-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; }
  .cost-item:hover { border-color: var(--primary); }
  .cost-item .cost-cat { font-size: 11px; font-weight: 600; color: var(--text-muted); }
  .cost-item .cost-desc { font-size: 14px; font-weight: 500; }
  .cost-item .cost-amount { font-size: 16px; font-weight: 700; }

  /* ‚îÄ‚îÄ REFERRAL ITEM ‚îÄ‚îÄ */
  .referral-item { border: 1px solid var(--border); border-radius: 8px; padding: 14px; margin-bottom: 8px; }
  .referral-item.pending { border-left: 4px solid var(--warning); }
  .referral-item.approved { border-left: 4px solid var(--secondary); }
  .referral-item.rejected { border-left: 4px solid var(--destructive); }

  /* ‚îÄ‚îÄ SUMMARY BLOCK ‚îÄ‚îÄ */
  .summary-block { background: var(--bg); border-radius: 8px; padding: 12px 14px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
  .summary-block .emp-name { font-size: 13px; font-weight: 600; }
  .summary-block .emp-count { font-size: 12px; color: var(--text-muted); }
  .summary-block .emp-total { font-size: 16px; font-weight: 700; color: var(--primary); }

  /* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
  .profile-avatar { width: 72px; height: 72px; border-radius: 99px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 28px; color: #fff; font-weight: 700; }

  /* ‚îÄ‚îÄ FREQUENCY ITEM ‚îÄ‚îÄ */
  .freq-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 6px; }
  .freq-item:hover { border-color: var(--primary); background: var(--bg); }

  /* ‚îÄ‚îÄ NOTIFICATION ITEM ‚îÄ‚îÄ */
  .notif-item { border: 1px solid var(--border); border-radius: 8px; padding: 14px; margin-bottom: 8px; }
  .notif-item.pending { border-left: 4px solid var(--destructive); }
  .notif-item.read { border-left: 4px solid var(--border); opacity: .8; }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty { text-align: center; padding: 48px 20px; color: var(--text-muted); font-size: 14px; }
  .empty .icon { font-size: 40px; margin-bottom: 8px; }

  /* ‚îÄ‚îÄ TABS NAV ‚îÄ‚îÄ */
  .tabs-nav { display: flex; gap: 4px; background: var(--bg); border-radius: 8px; padding: 4px; margin-bottom: 16px; }
  .tab-btn { flex: 1; padding: 7px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; color: var(--text-muted); text-align: center; cursor: pointer; transition: all .15s; }
  .tab-btn.active { background: var(--card); color: var(--primary); box-shadow: 0 1px 4px rgba(0,0,0,.1); }

  /* ‚îÄ‚îÄ PAYMENT STATUS ‚îÄ‚îÄ */
  .pay-status { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 99px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all .15s; }
  .pay-status.paid { background: var(--secondary-light); color: var(--secondary); }
  .pay-status.unpaid { background: var(--warning-light); color: var(--warning); }

  /* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
  .mobile-menu-btn { display: none; }
  @media (max-width: 768px) {
    .sidebar { display: none; position: fixed; left: 0; top: var(--header-h); height: calc(100vh - var(--header-h)); z-index: 200; transform: translateX(-100%); transition: transform .25s; }
    .sidebar.open { display: flex; flex-direction: column; transform: translateX(0); }
    .mobile-menu-btn { display: flex; }
    .main-content { padding: 16px; }
    .grid-4 { grid-template-columns: 1fr 1fr; }
    .grid-3 { grid-template-columns: 1fr 1fr; }
    .grid-2 { grid-template-columns: 1fr; }
    .week-grid { grid-template-columns: repeat(4, 1fr); }
    .user-info { display: none; }
    .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.4); z-index: 150; top: var(--header-h); }
    .sidebar-overlay.open { display: block; }
  }
</style>
</head>
<body>

<!-- TOAST CONTAINER -->
<div id="toast-container"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="login-page">
  <div class="login-card">
    <div class="login-logo">
      <div class="spark">‚ú¶</div>
      <h1>WR Cleaning Service</h1>
      <p>Sistema de Gest√£o Financeira</p>
    </div>

    <!-- Login Form -->
    <div id="login-form">
      <div class="form-group">
        <label>Email</label>
        <input type="text" class="form-control" id="login-email" placeholder="seu@email.com" />
      </div>
      <div class="form-group">
        <label>Senha</label>
        <input type="password" class="form-control" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn btn-primary btn-full" onclick="doLogin()">Entrar</button>
      <div class="login-switch" style="margin-top:10px">
        <button onclick="toggleView('forgot')">Esqueci minha senha</button>
      </div>
      <div class="login-switch">
        N√£o tem conta? <button onclick="toggleView('register')">Criar conta</button>
      </div>
    </div>

    <!-- Register Form -->
    <div id="register-form" class="hidden">
      <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" placeholder="seu@email.com" />
      </div>
      <button class="btn btn-primary btn-full" onclick="toast('C√≥digo enviado! Verifique seu email.','success')">Enviar C√≥digo</button>
      <div class="login-switch" style="margin-top:10px">
        <button onclick="toggleView('login')">Voltar ao Login</button>
      </div>
    </div>

    <!-- Forgot Password Form -->
    <div id="forgot-form" class="hidden">
      <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" placeholder="seu@email.com" />
      </div>
      <button class="btn btn-primary btn-full" onclick="toast('C√≥digo enviado!','success')">Enviar C√≥digo de Verifica√ß√£o</button>
      <div class="login-switch" style="margin-top:10px">
        <button onclick="toggleView('login')">Voltar ao login</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app-page" class="hidden">
  <!-- Header -->
  <header class="app-header">
    <div style="display:flex;align-items:center;gap:12px">
      <button class="btn btn-ghost btn-icon mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
      <div class="header-logo">
        <span class="spark">‚ú¶</span>
        <div>
          <h2>WR Cleaning Service</h2>
          <span>Painel Administrativo</span>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="name" id="header-username">Admin</div>
        <div class="email" id="header-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e081848da09792838c85818e898e87ce838f8d">[email&#160;protected]</a></div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="doLogout()">‚¨° Sair</button>
    </div>
  </header>

  <div class="app-body">
    <!-- Sidebar overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <nav>
        <button class="nav-item active" data-tab="dashboard" onclick="navigate(this)">
          <span class="icon">‚äû</span> Dashboard
        </button>
        <button class="nav-item" data-tab="schedule" onclick="navigate(this)">
          <span class="icon">üìÖ</span> Schedule
        </button>
        <button class="nav-item" data-tab="checklist" onclick="navigate(this)">
          <span class="icon">üíµ</span> Pagamentos
        </button>
        <button class="nav-item" data-tab="clients" onclick="navigate(this)">
          <span class="icon">üë•</span> Clientes
        </button>
        <button class="nav-item" data-tab="employees" onclick="navigate(this)">
          <span class="icon">üíº</span> Funcion√°rios
        </button>
        <button class="nav-item" data-tab="costs" onclick="navigate(this)">
          <span class="icon">üßæ</span> Custos
        </button>
        <button class="nav-item" data-tab="notifications" onclick="navigate(this)">
          <span class="icon">üîî</span> Notifica√ß√µes
          <span class="nav-badge" id="notif-badge">2</span>
        </button>
        <button class="nav-item" data-tab="frequencies" onclick="navigate(this)">
          <span class="icon">üìÜ</span> Frequ√™ncias
        </button>
        <button class="nav-item" data-tab="referrals" onclick="navigate(this)">
          <span class="icon">üéÅ</span> Indica√ß√µes
        </button>
        <button class="nav-item" data-tab="profile" onclick="navigate(this)">
          <span class="icon">‚öô</span> Perfil
        </button>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main-content">
      <!-- Notification Banner -->
      <div class="notif-banner" id="main-notif-banner">
        <span class="icon">üîî</span>
        <div style="flex:1">
          <div class="title">2 Novas Notifica√ß√µes</div>
          <div class="desc">Observa√ß√µes de funcion√°rios aguardam sua visualiza√ß√£o</div>
        </div>
        <button class="btn btn-outline btn-sm" onclick="navigate(document.querySelector('[data-tab=notifications]'))">Ver</button>
      </div>

      <!-- ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ -->
      <div class="tab-content active" id="tab-dashboard">
        <div class="card mb-4">
          <div class="card-header"><h3>Filtros de Per√≠odo</h3></div>
          <div class="card-body">
            <div class="grid-3" style="gap:12px">
              <div class="form-group" style="margin:0">
                <label>Data Inicial</label>
                <input type="date" class="form-control" id="dash-start" value="2026-02-01" onchange="updateDash()"/>
              </div>
              <div class="form-group" style="margin:0">
                <label>Data Final</label>
                <input type="date" class="form-control" id="dash-end" value="2026-02-28" onchange="updateDash()"/>
              </div>
              <div class="form-group" style="margin:0">
                <label>M√™s/Ano</label>
                <input type="month" class="form-control" id="dash-month" value="2026-02" onchange="updateDashMonth()"/>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-4 mb-4" id="dash-stats">
          <!-- filled by JS -->
        </div>

        <div class="grid-3 mb-4" id="dash-secondary">
          <!-- filled by JS -->
        </div>

        <div class="card">
          <div class="card-header"><h3>Ranking de Lucratividade por Cliente</h3></div>
          <div class="card-body table-responsive">
            <table class="table" id="ranking-table">
              <thead><tr>
                <th>#</th><th>Cliente</th><th>Frequ√™ncia</th>
                <th style="text-align:right">Valor Cobrado</th>
                <th style="text-align:right">Custo M.O.</th>
                <th style="text-align:right">Lucro Previsto</th>
              </tr></thead>
              <tbody id="ranking-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ SCHEDULE ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-schedule">
        <div class="page-header">
          <h2>üìÖ Agenda Semanal</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn btn-outline btn-sm" onclick="prevWeek()">‚óÄ</button>
            <span id="week-label" style="font-size:13px;font-weight:600"></span>
            <button class="btn btn-outline btn-sm" onclick="nextWeek()">‚ñ∂</button>
            <button class="btn btn-primary btn-sm" onclick="openModal('schedule-modal')">+ Adicionar</button>
          </div>
        </div>
        <div class="week-grid" id="week-grid"></div>

        <div class="card mt-4">
          <div class="card-header"><h3>Lista de Agendamentos</h3></div>
          <div class="card-body" id="schedule-list"></div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ CHECKLIST (Pagamentos) ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-checklist">
        <div class="page-header">
          <h2>üíµ Registros de Trabalho</h2>
          <button class="btn btn-primary" onclick="openAddWorkLog()">+ Novo Registro</button>
        </div>

        <div class="card mb-4">
          <div class="card-header"><h3>Filtros</h3></div>
          <div class="card-body">
            <div class="grid-3">
              <div class="form-group" style="margin:0">
                <label>Data Inicial</label>
                <input type="date" class="form-control" id="cl-start" value="2026-02-01" onchange="renderChecklist()"/>
              </div>
              <div class="form-group" style="margin:0">
                <label>Data Final</label>
                <input type="date" class="form-control" id="cl-end" value="2026-02-28" onchange="renderChecklist()"/>
              </div>
              <div class="form-group" style="margin:0">
                <label>M√™s/Ano</label>
                <input type="month" class="form-control" id="cl-month" value="2026-02" onchange="clMonth()"/>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-2 mb-4">
          <div class="card">
            <div class="card-header"><h3>Resumo de Pagamentos por Funcion√°ria</h3></div>
            <div class="card-body" id="emp-payments-summary"></div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Status do Per√≠odo</h3></div>
            <div class="card-body" id="cl-period-stats"></div>
          </div>
        </div>

        <div id="work-logs-list"></div>
      </div>

      <!-- ‚îÄ‚îÄ CLIENTS ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-clients">
        <div class="page-header">
          <h2>üë• Clientes</h2>
          <button class="btn btn-primary" onclick="openModal('client-modal')">+ Adicionar Cliente</button>
        </div>
        <div class="card">
          <div class="card-body table-responsive">
            <table class="table">
              <thead><tr>
                <th>Nome</th><th>Frequ√™ncia</th><th>Valor</th>
                <th>Funcion√°rias</th><th>Transporte</th><th>A√ß√µes</th>
              </tr></thead>
              <tbody id="clients-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ EMPLOYEES ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-employees">
        <div class="tabs-nav">
          <div class="tab-btn active" onclick="empTab(this,'active-emps')">Funcion√°rios Ativos</div>
          <div class="tab-btn" onclick="empTab(this,'pending-users')">Usu√°rios Pendentes</div>
        </div>

        <div id="active-emps">
          <div class="page-header">
            <h2>üíº Funcion√°rios</h2>
            <button class="btn btn-primary" onclick="openModal('emp-modal')">+ Adicionar Funcion√°rio</button>
          </div>
          <div class="card">
            <div class="card-body table-responsive">
              <table class="table">
                <thead><tr><th>Nome</th><th>Email</th><th>Desde</th><th>A√ß√µes</th></tr></thead>
                <tbody id="emp-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="pending-users" class="hidden">
          <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚è≥ Usu√°rios Aguardando Aprova√ß√£o</h2>
          <div id="pending-list"></div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ COSTS ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-costs">
        <div class="page-header">
          <h2>üßæ Custos</h2>
          <button class="btn btn-primary" onclick="openModal('cost-modal')">+ Adicionar Custo</button>
        </div>

        <div class="grid-2 mb-4">
          <div class="stat-card" style="border-left:4px solid var(--primary)">
            <div class="stat-label">üîÑ Custos Recorrentes / m√™s</div>
            <div class="stat-value text-primary" id="cost-recurrent">$0.00</div>
          </div>
          <div class="stat-card" style="border-left:4px solid var(--warning)">
            <div class="stat-label">‚ö° Custos √önicos</div>
            <div class="stat-value" style="color:var(--warning)" id="cost-unique">$0.00</div>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-bottom:16px">
          <button class="btn btn-outline btn-sm" style="border-radius:99px" onclick="filterCosts('all',this)">Todos</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" onclick="filterCosts('recorrente',this)">Recorrentes</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" onclick="filterCosts('unico',this)">√önicos</button>
        </div>

        <div id="costs-list"></div>
      </div>

      <!-- ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-notifications">
        <div class="page-header">
          <h2>üîî Notifica√ß√µes das Funcion√°rias</h2>
          <span class="badge badge-destructive" id="notif-count-badge">2 pendentes</span>
        </div>
        <div id="notifications-list"></div>
      </div>

      <!-- ‚îÄ‚îÄ FREQUENCIES ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-frequencies">
        <div class="page-header">
          <h2>üìÜ Modelos de Frequ√™ncia</h2>
          <button class="btn btn-primary" onclick="openModal('freq-modal')">+ Adicionar Frequ√™ncia</button>
        </div>
        <div class="card">
          <div class="card-header"><h3>üìã Lista de Frequ√™ncias</h3></div>
          <div class="card-body" id="freq-list"></div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ REFERRALS ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-referrals">
        <div class="page-header">
          <h2>üéÅ Gerenciar Indica√ß√µes</h2>
        </div>
        <div class="grid-3 mb-4" id="referral-stats"></div>
        <div id="referrals-list"></div>
      </div>

      <!-- ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ -->
      <div class="tab-content" id="tab-profile">
        <h2 style="font-size:22px;font-weight:800;margin-bottom:20px">‚öô Perfil</h2>
        <div class="card" style="max-width:480px">
          <div class="card-body">
            <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
              <div class="profile-avatar" id="profile-avatar">A</div>
              <div>
                <div style="font-size:18px;font-weight:700" id="profile-name">Admin</div>
                <div style="font-size:13px;color:var(--text-muted)" id="profile-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="74151019340306171811151a1d1a135a171b19">[email&#160;protected]</a></div>
                <span class="badge badge-primary" style="margin-top:4px">Administrador</span>
              </div>
            </div>
            <hr class="divider">
            <div class="form-group">
              <label>Nome de usu√°rio</label>
              <input type="text" class="form-control" id="profile-username-input" value="Admin" />
            </div>
            <div class="form-group">
              <label>Nova Senha</label>
              <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
            <div class="form-group">
              <label>Confirmar Senha</label>
              <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
            <button class="btn btn-primary" onclick="toast('Perfil atualizado com sucesso!','success')">Salvar Altera√ß√µes</button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- SCHEDULE MODAL -->
<div class="modal-overlay hidden" id="schedule-modal">
  <div class="modal modal-lg">
    <h2>üìÖ Novo Agendamento</h2>
    <div class="form-group">
      <label>Data</label>
      <input type="date" class="form-control" id="sch-date" />
    </div>
    <div class="form-group">
      <label>Cliente</label>
      <select class="form-control" id="sch-client">
        <option value="">Selecione...</option>
      </select>
    </div>
    <div class="form-group">
      <label>Funcion√°ria</label>
      <select class="form-control" id="sch-emp">
        <option value="">Selecione...</option>
      </select>
    </div>
    <div class="form-group">
      <label>Status</label>
      <select class="form-control" id="sch-status">
        <option value="pendente">Pendente</option>
        <option value="confirmado">Confirmado</option>
        <option value="cancelado">Cancelado</option>
      </select>
    </div>
    <div class="form-group">
      <label>Observa√ß√µes</label>
      <textarea class="form-control" id="sch-notes" placeholder="Opcional..."></textarea>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveSchedule()">Salvar</button>
      <button class="btn btn-outline" onclick="closeModal('schedule-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- CHECKLIST MODAL -->
<div class="modal-overlay hidden" id="checklist-modal">
  <div class="modal modal-lg">
    <h2 id="checklist-modal-title">üíµ Novo Registro de Trabalho</h2>
    <input type="hidden" id="cl-edit-id" />
    <div class="form-group">
      <label>Cliente</label>
      <select class="form-control" id="cl-client">
        <option value="">Selecione o cliente...</option>
      </select>
    </div>
    <div class="form-group">
      <label>Data</label>
      <input type="date" class="form-control" id="cl-date" />
    </div>
    <div class="form-group">
      <label>Status</label>
      <select class="form-control" id="cl-status">
        <option value="Pendente">Pendente</option>
        <option value="Confirmado">Confirmado</option>
        <option value="Cancelado">Cancelado</option>
      </select>
    </div>
    <div class="form-group" id="cl-reason-group" style="display:none">
      <label>Motivo do Cancelamento</label>
      <textarea class="form-control" id="cl-reason"></textarea>
    </div>
    <div class="form-group">
      <label>Receita (R$)</label>
      <input type="number" class="form-control" id="cl-revenue" placeholder="0.00" step="0.01" />
    </div>
    <hr class="divider">
    <div style="margin-bottom:10px;font-weight:600;font-size:14px">Funcion√°rias no Trabalho</div>
    <div id="cl-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" onclick="addEmpRow()">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-primary" onclick="saveWorkLog()">Salvar</button>
      <button class="btn btn-outline" onclick="closeModal('checklist-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- CLIENT MODAL -->
<div class="modal-overlay hidden" id="client-modal">
  <div class="modal modal-lg">
    <h2 id="client-modal-title">üë• Adicionar Cliente</h2>
    <input type="hidden" id="client-edit-id" />
    <div class="form-group">
      <label>Nome</label>
      <input type="text" class="form-control" id="client-name" placeholder="Nome do cliente" />
    </div>
    <div class="form-group">
      <label>Frequ√™ncia</label>
      <select class="form-control" id="client-freq">
        <option value="">Selecione...</option>
      </select>
    </div>
    <div class="form-group">
      <label>Valor Cobrado (R$)</label>
      <input type="number" class="form-control" id="client-price" placeholder="0.00" step="0.01" />
    </div>
    <div class="form-group" style="display:flex;align-items:center;gap:8px">
      <input type="checkbox" id="client-transport" style="width:16px;height:16px" />
      <label for="client-transport" style="margin:0">Sem custo de transporte</label>
    </div>
    <hr class="divider">
    <div style="font-weight:600;font-size:14px;margin-bottom:10px">Funcion√°rias Designadas</div>
    <div id="client-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" onclick="addClientEmpRow()">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-primary" onclick="saveClient()">Salvar</button>
      <button class="btn btn-outline" onclick="closeModal('client-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- EMPLOYEE MODAL -->
<div class="modal-overlay hidden" id="emp-modal">
  <div class="modal">
    <h2>üíº Adicionar Funcion√°rio</h2>
    <div class="form-group">
      <label>Nome</label>
      <input type="text" class="form-control" id="emp-name" placeholder="Nome completo" />
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" class="form-control" id="emp-email" placeholder="email@exemplo.com" />
    </div>
    <div class="form-group">
      <label>Senha</label>
      <input type="password" class="form-control" id="emp-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveEmployee()">Criar Funcion√°rio</button>
      <button class="btn btn-outline" onclick="closeModal('emp-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- COST MODAL -->
<div class="modal-overlay hidden" id="cost-modal">
  <div class="modal">
    <h2>üßæ Adicionar Custo</h2>
    <div class="form-group">
      <label>Categoria</label>
      <select class="form-control" id="cost-cat">
        <option>Transporte</option>
        <option>Produtos de Limpeza</option>
        <option>Manuten√ß√£o</option>
        <option>Outros</option>
      </select>
    </div>
    <div class="form-group">
      <label>Descri√ß√£o</label>
      <input type="text" class="form-control" id="cost-desc" placeholder="Descri√ß√£o do custo" />
    </div>
    <div class="form-group">
      <label>Valor (R$)</label>
      <input type="number" class="form-control" id="cost-amount" placeholder="0.00" step="0.01" />
    </div>
    <div class="form-group">
      <label>Tipo</label>
      <select class="form-control" id="cost-type">
        <option value="unico">√önico</option>
        <option value="recorrente">Recorrente</option>
      </select>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveCost()">Adicionar</button>
      <button class="btn btn-outline" onclick="closeModal('cost-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- FREQ MODAL -->
<div class="modal-overlay hidden" id="freq-modal">
  <div class="modal">
    <h2 id="freq-modal-title">üìÜ Adicionar Frequ√™ncia</h2>
    <input type="hidden" id="freq-edit-id" />
    <div class="form-group">
      <label>Nome da Frequ√™ncia</label>
      <input type="text" class="form-control" id="freq-name" placeholder="Ex: Semanal, Quinzenal, Mensal..." />
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveFreq()">Salvar</button>
      <button class="btn btn-outline" onclick="closeModal('freq-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- APPROVE MODAL -->
<div class="modal-overlay hidden" id="approve-modal">
  <div class="modal">
    <h2>‚úÖ Aprovar Usu√°rio</h2>
    <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px">Informe o nome do funcion√°rio para aprova√ß√£o.</p>
    <input type="hidden" id="approve-user-id" />
    <div class="form-group">
      <label>Nome do Funcion√°rio</label>
      <input type="text" class="form-control" id="approve-name" placeholder="Nome completo" />
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-secondary" onclick="approveUser()">Aprovar</button>
      <button class="btn btn-outline" onclick="closeModal('approve-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- REFERRAL APPROVE MODAL -->
<div class="modal-overlay hidden" id="ref-modal">
  <div class="modal">
    <h2>üéÅ Aprovar Indica√ß√£o</h2>
    <input type="hidden" id="ref-edit-id" />
    <div class="form-group">
      <label>Valor do B√¥nus (R$)</label>
      <input type="number" class="form-control" id="ref-bonus" placeholder="0.00" step="0.01" />
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-secondary" onclick="approveReferral()">Aprovar com B√¥nus</button>
      <button class="btn btn-outline" onclick="closeModal('ref-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EMPLOYEE APP PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="emp-app-page" class="hidden">
  <!-- Header -->
  <header class="app-header">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="header-logo">
        <span class="spark">‚ú¶</span>
        <div>
          <h2>WR Cleaning</h2>
          <span id="emp-header-sub">Funcion√°ria</span>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="name" id="emp-header-username"></div>
        <div class="email" id="emp-header-email"></div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="doLogout()">‚¨° Sair</button>
    </div>
  </header>

  <!-- Employee Tab Nav -->
  <div style="background:var(--card);border-bottom:1px solid var(--border);overflow-x:auto">
    <div style="display:flex;gap:0;min-width:max-content;padding:0 16px">
      <button class="emp-tab-btn active" data-etab="emp-ganhos" onclick="empNavigate(this)">üí∞ Ganhos</button>
      <button class="emp-tab-btn" data-etab="emp-agenda" onclick="empNavigate(this)">üìÖ Agenda</button>
      <button class="emp-tab-btn" data-etab="emp-clientes" onclick="empNavigate(this)">üë• Clientes</button>
      <button class="emp-tab-btn" data-etab="emp-indique" onclick="empNavigate(this)">üéÅ Indique</button>
      <button class="emp-tab-btn" data-etab="emp-perfil" onclick="empNavigate(this)">‚öôÔ∏è Perfil</button>
    </div>
  </div>

  <main class="main-content">

    <!-- ‚îÄ‚îÄ GANHOS (Dashboard funcion√°ria) ‚îÄ‚îÄ -->
    <div class="tab-content active" id="tab-emp-ganhos">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üí∞ Meus Ganhos</h2>

      <!-- Filtro per√≠odo -->
      <div class="card mb-4">
        <div class="card-body" style="padding:12px 16px">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn btn-outline btn-sm" style="border-radius:99px" onclick="setEmpPeriod('semana',this)">Esta semana</button>
            <button class="btn btn-primary btn-sm" style="border-radius:99px" onclick="setEmpPeriod('mes',this)">Este m√™s</button>
            <button class="btn btn-outline btn-sm" style="border-radius:99px" onclick="setEmpPeriod('ano',this)">Este ano</button>
          </div>
        </div>
      </div>

      <!-- Stats -->
      <div class="grid-3 mb-4" id="emp-stats"></div>

      <!-- Work logs list -->
      <div class="card">
        <div class="card-header"><h3>Hist√≥rico de Trabalhos</h3></div>
        <div class="card-body" id="emp-work-list"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ AGENDA (funcion√°ria) ‚îÄ‚îÄ -->
    <div class="tab-content" id="tab-emp-agenda">
      <div class="page-header">
        <h2>üìÖ Minha Agenda</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn btn-outline btn-sm" onclick="empPrevWeek()">‚óÄ</button>
          <span id="emp-week-label" style="font-size:13px;font-weight:600"></span>
          <button class="btn btn-outline btn-sm" onclick="empNextWeek()">‚ñ∂</button>
        </div>
      </div>
      <div class="week-grid" id="emp-week-grid"></div>

      <div class="card mt-4">
        <div class="card-header"><h3>Agendamentos da Semana</h3></div>
        <div class="card-body" id="emp-schedule-list"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ CLIENTES (funcion√°ria) ‚îÄ‚îÄ -->
    <div class="tab-content" id="tab-emp-clientes">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üë• Meus Clientes</h2>
      <div id="emp-clients-list"></div>

      <div class="card mt-4">
        <div class="card-header" style="display:flex;align-items:center;justify-content:space-between">
          <h3>üí¨ Minhas Observa√ß√µes</h3>
          <button class="btn btn-primary btn-sm" onclick="openModal('emp-note-modal')">+ Nova Observa√ß√£o</button>
        </div>
        <div class="card-body" id="emp-notes-list"></div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ INDIQUE (referrals funcion√°ria) ‚îÄ‚îÄ -->
    <div class="tab-content" id="tab-emp-indique">
      <div class="page-header">
        <h2>üéÅ Programa de Indica√ß√µes</h2>
        <button class="btn btn-primary" onclick="openModal('emp-ref-modal')">+ Nova Indica√ß√£o</button>
      </div>

      <!-- Info card -->
      <div class="card mb-4" style="border-left:4px solid var(--secondary);background:var(--secondary-light)">
        <div class="card-body">
          <div style="font-weight:700;color:var(--secondary);margin-bottom:4px">üéÅ Como funciona?</div>
          <div style="font-size:13px;color:#065f46">Indique um amigo ou familiar e, quando aprovado, voc√™ recebe um b√¥nus especial! Preencha os dados do poss√≠vel cliente e aguarde a aprova√ß√£o da administra√ß√£o.</div>
        </div>
      </div>

      <div id="emp-referrals-stats" class="grid-3 mb-4"></div>
      <div id="emp-referrals-list"></div>
    </div>

    <!-- ‚îÄ‚îÄ PERFIL (funcion√°ria) ‚îÄ‚îÄ -->
    <div class="tab-content" id="tab-emp-perfil">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚öôÔ∏è Meu Perfil</h2>
      <div class="card" style="max-width:480px">
        <div class="card-body">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
            <div class="profile-avatar" id="emp-profile-avatar">A</div>
            <div>
              <div style="font-size:18px;font-weight:700" id="emp-profile-name">Colaboradora</div>
              <div style="font-size:13px;color:var(--text-muted)" id="emp-profile-email"></div>
              <span class="badge badge-gray" style="margin-top:4px">Colaborador</span>
            </div>
          </div>
          <hr class="divider">
          <div class="form-group">
            <label>Novo Nome</label>
            <input type="text" class="form-control" id="emp-new-name" placeholder="Seu nome" />
          </div>
          <button class="btn btn-primary btn-sm mb-4" onclick="toast('Nome atualizado!','success')">Salvar Nome</button>
          <hr class="divider">
          <div class="form-group">
            <label>Novo Email</label>
            <input type="email" class="form-control" id="emp-new-email" placeholder="novo@email.com" />
          </div>
          <button class="btn btn-primary btn-sm mb-4" onclick="toast('Email atualizado!','success')">Salvar Email</button>
          <hr class="divider">
          <div class="form-group">
            <label>Nova Senha</label>
            <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
          <div class="form-group">
            <label>Confirmar Senha</label>
            <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
          <button class="btn btn-primary btn-sm" onclick="toast('Senha atualizada!','success')">Salvar Senha</button>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- EMPLOYEE NOTE MODAL -->
<div class="modal-overlay hidden" id="emp-note-modal">
  <div class="modal">
    <h2>üí¨ Nova Observa√ß√£o</h2>
    <div class="form-group">
      <label>Cliente</label>
      <select class="form-control" id="note-client-sel"></select>
    </div>
    <div class="form-group">
      <label>Observa√ß√£o</label>
      <textarea class="form-control" id="note-text" placeholder="Descreva sua observa√ß√£o..." rows="4"></textarea>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveEmpNote()">Enviar</button>
      <button class="btn btn-outline" onclick="closeModal('emp-note-modal')">Cancelar</button>
    </div>
  </div>
</div>

<!-- EMPLOYEE REFERRAL MODAL -->
<div class="modal-overlay hidden" id="emp-ref-modal">
  <div class="modal">
    <h2>üéÅ Nova Indica√ß√£o</h2>
    <div class="form-group">
      <label>Nome do Cliente Indicado</label>
      <input type="text" class="form-control" id="eref-name" placeholder="Nome completo" />
    </div>
    <div class="form-group">
      <label>Telefone</label>
      <input type="text" class="form-control" id="eref-phone" placeholder="(11) 99999-9999" />
    </div>
    <div class="form-group">
      <label>Endere√ßo</label>
      <input type="text" class="form-control" id="eref-address" placeholder="Rua, n√∫mero, bairro" />
    </div>
    <div class="form-group">
      <label>CEP</label>
      <input type="text" class="form-control" id="eref-zip" placeholder="00000-000" />
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveEmpRef()">Enviar Indica√ß√£o</button>
      <button class="btn btn-outline" onclick="closeModal('emp-ref-modal')">Cancelar</button>
    </div>
  </div>
</div>

<style>
  .emp-tab-btn { padding:12px 16px;font-size:13px;font-weight:600;color:var(--text-muted);border-bottom:2px solid transparent;cursor:pointer;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap;transition:all .15s; }
  .emp-tab-btn.active { color:var(--primary);border-bottom-color:var(--primary); }
  .emp-tab-btn:hover { color:var(--text);background:var(--bg); }
</style>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA STORE (in-memory mock)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const db = {
  employees: [
    { id: 'e1', name: 'Ana Silva', email: 'ana@exemplo.com', created_at: '2025-01-10' },
    { id: 'e2', name: 'Maria Santos', email: 'maria@exemplo.com', created_at: '2025-02-15' },
    { id: 'e3', name: 'Renata Oliveira', email: 'renata@exemplo.com', created_at: '2025-03-20' },
  ],
  frequencies: [
    { id: 'f1', name: 'Semanal' },
    { id: 'f2', name: 'Quinzenal' },
    { id: 'f3', name: 'Mensal' },
    { id: 'f4', name: 'A cada 3 semanas' },
  ],
  clients: [
    { id: 'c1', name: 'Fam√≠lia Johnson', frequency: 'Semanal', price: 180, no_transport_cost: false, client_employees: [{ employee_id: 'e1', payment_amount: 60 }, { employee_id: 'e2', payment_amount: 60 }] },
    { id: 'c2', name: 'Escrit√≥rio Tech Co', frequency: 'Quinzenal', price: 320, no_transport_cost: true, client_employees: [{ employee_id: 'e1', payment_amount: 90 }, { employee_id: 'e3', payment_amount: 80 }] },
    { id: 'c3', name: 'Sra. Williams', frequency: 'Mensal', price: 150, no_transport_cost: false, client_employees: [{ employee_id: 'e2', payment_amount: 55 }] },
    { id: 'c4', name: 'Apartamento Davis', frequency: 'Quinzenal', price: 200, no_transport_cost: false, client_employees: [{ employee_id: 'e3', payment_amount: 70 }] },
    { id: 'c5', name: 'Casa Martinez', frequency: 'Semanal', price: 160, no_transport_cost: false, client_employees: [{ employee_id: 'e1', payment_amount: 50 }, { employee_id: 'e2', payment_amount: 50 }] },
  ],
  costs: [
    { id: 'co1', category: 'Transporte', description: 'Gasolina mensal', amount: 150, cost_type: 'recorrente', created_at: '2026-02-01' },
    { id: 'co2', category: 'Produtos de Limpeza', description: 'Fornecedor mensal', amount: 220, cost_type: 'recorrente', created_at: '2026-02-01' },
    { id: 'co3', category: 'Manuten√ß√£o', description: 'Aspirador de p√≥ novo', amount: 350, cost_type: 'unico', created_at: '2026-02-10' },
    { id: 'co4', category: 'Outros', description: 'Uniformes', amount: 180, cost_type: 'unico', created_at: '2026-02-14' },
  ],
  workLogs: [
    { id: 'w1', client_id: 'c1', work_date: '2026-02-03', status: 'Confirmado', revenue: 180, work_log_employees: [{ employee_id: 'e1', payment_amount: 60 }, { employee_id: 'e2', payment_amount: 60 }] },
    { id: 'w2', client_id: 'c2', work_date: '2026-02-05', status: 'Confirmado', revenue: 320, work_log_employees: [{ employee_id: 'e1', payment_amount: 90 }, { employee_id: 'e3', payment_amount: 80 }] },
    { id: 'w3', client_id: 'c3', work_date: '2026-02-07', status: 'Confirmado', revenue: 150, work_log_employees: [{ employee_id: 'e2', payment_amount: 55 }] },
    { id: 'w4', client_id: 'c4', work_date: '2026-02-10', status: 'Confirmado', revenue: 200, work_log_employees: [{ employee_id: 'e3', payment_amount: 70 }] },
    { id: 'w5', client_id: 'c1', work_date: '2026-02-10', status: 'Confirmado', revenue: 180, work_log_employees: [{ employee_id: 'e1', payment_amount: 60 }, { employee_id: 'e2', payment_amount: 60 }] },
    { id: 'w6', client_id: 'c5', work_date: '2026-02-12', status: 'Cancelado', revenue: 0, cancellation_reason: 'Cliente desmarcou', work_log_employees: [] },
    { id: 'w7', client_id: 'c5', work_date: '2026-02-17', status: 'Confirmado', revenue: 160, work_log_employees: [{ employee_id: 'e1', payment_amount: 50 }, { employee_id: 'e2', payment_amount: 50 }] },
    { id: 'w8', client_id: 'c2', work_date: '2026-02-19', status: 'Confirmado', revenue: 320, work_log_employees: [{ employee_id: 'e1', payment_amount: 90 }, { employee_id: 'e3', payment_amount: 80 }] },
    { id: 'w9', client_id: 'c3', work_date: '2026-02-21', status: 'Confirmado', revenue: 150, work_log_employees: [{ employee_id: 'e2', payment_amount: 55 }] },
    { id: 'w10', client_id: 'c4', work_date: '2026-02-24', status: 'Confirmado', revenue: 200, work_log_employees: [{ employee_id: 'e3', payment_amount: 70 }] },
  ],
  scheduleEntries: [
    { id: 's1', work_date: '2026-02-23', client_id: 'c1', employee_ids: ['e1','e2'], status: 'confirmado', notes: '' },
    { id: 's2', work_date: '2026-02-24', client_id: 'c2', employee_ids: ['e1','e3'], status: 'confirmado', notes: '' },
    { id: 's3', work_date: '2026-02-25', client_id: 'c3', employee_ids: ['e2'], status: 'pendente', notes: 'Ligar antes' },
    { id: 's4', work_date: '2026-02-26', client_id: 'c5', employee_ids: ['e1','e2'], status: 'cancelado', notes: 'Cliente desmarcou' },
    { id: 's5', work_date: '2026-02-27', client_id: 'c4', employee_ids: ['e3'], status: 'pendente', notes: '' },
  ],
  notifications: [
    { id: 'n1', client_id: 'c1', employee_id: 'e1', note: 'Cliente pediu para usar produto espec√≠fico na pr√≥xima visita.', status: 'pending', created_at: '2026-02-22T10:30:00' },
    { id: 'n2', client_id: 'c3', employee_id: 'e2', note: 'Porta do banheiro est√° com problema, informar √† propriet√°ria.', status: 'pending', created_at: '2026-02-23T14:00:00' },
    { id: 'n3', client_id: 'c2', employee_id: 'e3', note: 'Chave extra deixada na recep√ß√£o.', status: 'read', created_at: '2026-02-20T09:00:00' },
  ],
  referrals: [
    { id: 'r1', employee_id: 'e1', client_name: 'Fam√≠lia Brown', phone: '(11) 99999-1111', address: 'Rua das Flores, 123', zip_code: '01234-567', status: 'pending', bonus_amount: 0, created_at: '2026-02-20' },
    { id: 'r2', employee_id: 'e2', client_name: 'Sr. Anderson', phone: '(11) 88888-2222', address: 'Av. Principal, 456', zip_code: '04567-890', status: 'approved', bonus_amount: 50, created_at: '2026-02-15' },
    { id: 'r3', employee_id: 'e3', client_name: 'Escrit√≥rio XYZ', phone: '(11) 77777-3333', address: 'Centro Comercial, 789', zip_code: '07890-123', status: 'rejected', bonus_amount: 0, created_at: '2026-02-10' },
  ],
  pendingUsers: [
    { id: 'pu1', email: 'novafunc@exemplo.com', created_at: '2026-02-23T08:00:00' },
  ],
};

let currentTab = 'dashboard';
let costsFilter = 'all';
let weekOffset = 0; // 0 = current week

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmt(v) { return '$' + Number(v).toFixed(2); }
function fmtDate(s) {
  const d = new Date(s + (s.length === 10 ? 'T00:00:00' : ''));
  return d.toLocaleDateString('pt-BR');
}
function toast(msg, type='success') {
  const c = document.getElementById('toast-container');
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `${type==='success'?'‚úì':'‚úï'} ${msg}`;
  c.appendChild(el);
  setTimeout(() => el.remove(), 3500);
}
function getClient(id) { return db.clients.find(c => c.id === id); }
function getEmployee(id) { return db.employees.find(e => e.id === id); }
function uid() { return '_' + Math.random().toString(36).substr(2,9); }

function openModal(id) {
  document.getElementById(id).classList.remove('hidden');
}
function closeModal(id) {
  document.getElementById(id).classList.add('hidden');
}
// Close modal on overlay click
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if(e.target === o) o.classList.add('hidden'); });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleView(v) {
  document.getElementById('login-form').classList.add('hidden');
  document.getElementById('register-form').classList.add('hidden');
  document.getElementById('forgot-form').classList.add('hidden');
  document.getElementById(v === 'login' ? 'login-form' : v === 'register' ? 'register-form' : 'forgot-form').classList.remove('hidden');
}

// Mock users
const USERS = {
  'adm': { role: 'adm', email: 'adm@wrcleaning.com', username: 'Admin', password: '123456' },
  'adm@wrcleaning.com': { role: 'adm', email: 'adm@wrcleaning.com', username: 'Admin', password: '123456' },
  'renatawaldehm@gmail.com': { role: 'adm', email: 'renatawaldehm@gmail.com', username: 'Renata', password: 'angelina123@' },
  'belami.viagens@gmail.com': { role: 'colaborador', email: 'belami.viagens@gmail.com', username: 'Ana Silva', employeeId: 'e1', password: '123456' },
  'vd273108@gmail.com': { role: 'colaborador', email: 'vd273108@gmail.com', username: 'Maria Santos', employeeId: 'e2', password: '123456' },
};

let currentUser = null;

function doLogin() {
  const emailRaw = document.getElementById('login-email').value.trim().toLowerCase();
  const pass = document.getElementById('login-pass').value;

  const user = USERS[emailRaw];
  if (!user || user.password !== pass) {
    toast('Email ou senha incorretos', 'error');
    return;
  }
  currentUser = user;
  document.getElementById('login-page').classList.add('hidden');

  if (user.role === 'adm') {
    document.getElementById('app-page').classList.remove('hidden');
    document.getElementById('header-username').textContent = user.username;
    document.getElementById('header-email').textContent = user.email;
    initApp();
  } else {
    // Colaborador
    document.getElementById('emp-app-page').classList.remove('hidden');
    document.getElementById('emp-header-username').textContent = user.username;
    document.getElementById('emp-header-email').textContent = user.email;
    const emp = db.employees.find(e => e.id === user.employeeId);
    document.getElementById('emp-header-sub').textContent = emp ? emp.name : 'Colaboradora';
    document.getElementById('emp-profile-name').textContent = user.username;
    document.getElementById('emp-profile-email').textContent = user.email;
    document.getElementById('emp-profile-avatar').textContent = user.username.charAt(0).toUpperCase();
    initEmpApp(user.employeeId);
  }
}

function doLogout() {
  currentUser = null;
  document.getElementById('app-page').classList.add('hidden');
  document.getElementById('emp-app-page').classList.add('hidden');
  document.getElementById('login-page').classList.remove('hidden');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navigate(btn) {
  const tab = btn.getAttribute('data-tab');
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  currentTab = tab;

  // Hide notification banner when on notifications tab
  const banner = document.getElementById('main-notif-banner');
  const pendingCount = db.notifications.filter(n => n.status === 'pending').length;
  if (tab === 'notifications' || pendingCount === 0) banner.classList.add('hidden');
  else banner.classList.remove('hidden');

  closeSidebar();
  renderTab(tab);
}

function renderTab(tab) {
  switch(tab) {
    case 'dashboard': renderDashboard(); break;
    case 'schedule': renderSchedule(); break;
    case 'checklist': renderChecklist(); break;
    case 'clients': renderClients(); break;
    case 'employees': renderEmployees(); break;
    case 'costs': renderCosts(); break;
    case 'notifications': renderNotifications(); break;
    case 'frequencies': renderFrequencies(); break;
    case 'referrals': renderReferrals(); break;
  }
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp() {
  populateSelects();
  updateNotifBadge();
  renderDashboard();
}

function updateNotifBadge() {
  const pending = db.notifications.filter(n => n.status === 'pending').length;
  const badge = document.getElementById('notif-badge');
  const banner = document.getElementById('main-notif-banner');
  if (pending > 0) {
    badge.textContent = pending;
    badge.classList.remove('hidden');
    if (currentTab !== 'notifications') banner.classList.remove('hidden');
  } else {
    badge.classList.add('hidden');
    banner.classList.add('hidden');
  }
  const cb = document.getElementById('notif-count-badge');
  if (cb) cb.textContent = `${pending} pendentes`;
}

function populateSelects() {
  // Client selects
  ['sch-client', 'cl-client'].forEach(id => {
    const sel = document.getElementById(id);
    if (!sel) return;
    sel.innerHTML = '<option value="">Selecione...</option>' + db.clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
  });
  // Employee selects
  ['sch-emp'].forEach(id => {
    const sel = document.getElementById(id);
    if (!sel) return;
    sel.innerHTML = '<option value="">Selecione...</option>' + db.employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
  });
  // Frequency selects for client modal
  const cf = document.getElementById('client-freq');
  if (cf) cf.innerHTML = '<option value="">Selecione...</option>' + db.frequencies.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
  // Today default
  const today = new Date().toISOString().split('T')[0];
  ['sch-date','cl-date'].forEach(id => { const el = document.getElementById(id); if(el && !el.value) el.value = today; });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDashMonth() {
  const m = document.getElementById('dash-month').value;
  const [y, mo] = m.split('-');
  const start = new Date(+y, +mo-1, 1);
  const end = new Date(+y, +mo, 0);
  document.getElementById('dash-start').value = start.toISOString().split('T')[0];
  document.getElementById('dash-end').value = end.toISOString().split('T')[0];
  renderDashboard();
}
function updateDash() { renderDashboard(); }

function renderDashboard() {
  const start = document.getElementById('dash-start').value;
  const end = document.getElementById('dash-end').value;

  const filtered = db.workLogs.filter(l => l.work_date >= start && l.work_date <= end);
  const confirmed = filtered.filter(l => l.status === 'Confirmado');
  const cancelled = filtered.filter(l => l.status === 'Cancelado');

  const totalRevenue = confirmed.reduce((s, l) => s + l.revenue, 0);
  const totalPayments = confirmed.reduce((s, l) => s + (l.work_log_employees || []).reduce((ps, e) => ps + e.payment_amount, 0), 0);

  // Costs
  const startD = new Date(start + 'T00:00:00');
  const endD = new Date(end + 'T00:00:00');
  const days = Math.ceil((endD - startD) / 86400000) + 1;
  const recurrentTotal = db.costs.filter(c => c.cost_type === 'recorrente').reduce((s, c) => s + c.amount, 0);
  const propRecurrent = (recurrentTotal / 30) * days;
  const uniqueTotal = db.costs.filter(c => c.cost_type === 'unico' && c.created_at >= start && c.created_at <= end).reduce((s, c) => s + c.amount, 0);
  const totalCosts = propRecurrent + uniqueTotal;
  const netProfit = totalRevenue - totalPayments - totalCosts;

  document.getElementById('dash-stats').innerHTML = `
    <div class="stat-card" style="border-left:4px solid var(--primary)">
      <div class="stat-label">üíµ Faturamento Real</div>
      <div class="stat-value text-primary">${fmt(totalRevenue)}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--destructive)">
      <div class="stat-label">üì§ Pagamentos Equipe</div>
      <div class="stat-value text-destructive">${fmt(totalPayments)}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--warning)">
      <div class="stat-label">üßæ Custos do Per√≠odo</div>
      <div class="stat-value" style="color:var(--warning)">${fmt(totalCosts)}</div>
      <div style="font-size:11px;color:var(--text-muted);margin-top:4px">
        Recorrente: ${fmt(propRecurrent)} | √önico: ${fmt(uniqueTotal)}<br>
        <span style="opacity:.7">${days} dias no per√≠odo</span>
      </div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)">
      <div class="stat-label">üìà Lucro L√≠quido</div>
      <div class="stat-value text-secondary">${fmt(netProfit)}</div>
    </div>
  `;

  document.getElementById('dash-secondary').innerHTML = `
    <div class="stat-card">
      <div class="stat-label">üë• Total de Clientes</div>
      <div class="stat-value">${db.clients.length}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">‚úÖ Trabalhos Confirmados</div>
      <div class="stat-value text-secondary">${confirmed.length}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">‚ùå Trabalhos Cancelados</div>
      <div class="stat-value text-destructive">${cancelled.length}</div>
    </div>
  `;

  // Ranking
  const ranking = db.clients.map(c => {
    const laborCost = (c.client_employees || []).reduce((s, ce) => s + ce.payment_amount, 0);
    return { ...c, laborCost, profit: c.price - laborCost };
  }).sort((a, b) => b.profit - a.profit);

  document.getElementById('ranking-body').innerHTML = ranking.map((c, i) => `
    <tr>
      <td>${i+1}</td>
      <td><strong>${c.name}</strong></td>
      <td><span class="badge badge-gray">${c.frequency}</span></td>
      <td style="text-align:right">${fmt(c.price)}</td>
      <td style="text-align:right">${fmt(c.laborCost)}</td>
      <td style="text-align:right;font-weight:700;color:var(--secondary)">${fmt(c.profit)}</td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCHEDULE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getWeekStart(d) {
  const dd = new Date(d);
  dd.setDate(dd.getDate() - dd.getDay());
  dd.setHours(0,0,0,0);
  return dd;
}

function renderSchedule() {
  const base = getWeekStart(new Date());
  base.setDate(base.getDate() + weekOffset * 7);
  const days = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(base);
    d.setDate(base.getDate() + i);
    days.push(d);
  }
  const startStr = days[0].toISOString().split('T')[0];
  const endStr = days[6].toISOString().split('T')[0];
  const todayStr = new Date().toISOString().split('T')[0];

  document.getElementById('week-label').textContent =
    `${days[0].toLocaleDateString('pt-BR',{day:'2-digit',month:'short'})} ‚Äì ${days[6].toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'})}`;

  const dayNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];

  document.getElementById('week-grid').innerHTML = days.map((d, i) => {
    const ds = d.toISOString().split('T')[0];
    const entries = db.scheduleEntries.filter(e => e.work_date === ds);
    return `
      <div class="day-col ${ds === todayStr ? 'today' : ''}">
        <div class="day-label">${dayNames[i]}</div>
        <div class="day-num">${d.getDate()}</div>
        ${entries.map(e => {
          const cl = getClient(e.client_id);
          return `<div class="schedule-item ${e.status}" title="${e.notes||''}">
            <div style="font-weight:600">${cl ? cl.name : '?'}</div>
            <span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}" style="font-size:10px">${e.status}</span>
          </div>`;
        }).join('')}
      </div>
    `;
  }).join('');

  // List
  const weekEntries = db.scheduleEntries.filter(e => e.work_date >= startStr && e.work_date <= endStr)
    .sort((a, b) => a.work_date.localeCompare(b.work_date));

  document.getElementById('schedule-list').innerHTML = weekEntries.length === 0
    ? '<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento nesta semana</div>'
    : weekEntries.map(e => {
        const cl = getClient(e.client_id);
        const emps = (e.employee_ids || []).map(id => getEmployee(id)?.name || id).join(', ');
        return `
          <div class="log-row">
            <div class="log-info">
              <div class="log-date">${fmtDate(e.work_date)}</div>
              <div class="log-client">${cl ? cl.name : '?'}</div>
              <div class="log-employees">üë§ ${emps || 'Nenhuma'}</div>
              ${e.notes ? `<div style="font-size:12px;color:var(--text-muted);font-style:italic;margin-top:2px">"${e.notes}"</div>` : ''}
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}">${e.status}</span>
              <button class="btn btn-danger btn-icon btn-sm" onclick="deleteSchedule('${e.id}')">üóë</button>
            </div>
          </div>
        `;
      }).join('');
}

function prevWeek() { weekOffset--; renderSchedule(); }
function nextWeek() { weekOffset++; renderSchedule(); }

function saveSchedule() {
  const date = document.getElementById('sch-date').value;
  const clientId = document.getElementById('sch-client').value;
  const empId = document.getElementById('sch-emp').value;
  const status = document.getElementById('sch-status').value;
  const notes = document.getElementById('sch-notes').value;
  if (!date || !clientId) { toast('Preencha data e cliente','error'); return; }
  db.scheduleEntries.push({ id: uid(), work_date: date, client_id: clientId, employee_ids: empId ? [empId] : [], status, notes });
  closeModal('schedule-modal');
  toast('Agendamento criado!','success');
  renderSchedule();
}

function deleteSchedule(id) {
  if (!confirm('Remover agendamento?')) return;
  db.scheduleEntries = db.scheduleEntries.filter(e => e.id !== id);
  toast('Agendamento removido','success');
  renderSchedule();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHECKLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function clMonth() {
  const m = document.getElementById('cl-month').value;
  const [y, mo] = m.split('-');
  document.getElementById('cl-start').value = new Date(+y, +mo-1, 1).toISOString().split('T')[0];
  document.getElementById('cl-end').value = new Date(+y, +mo, 0).toISOString().split('T')[0];
  renderChecklist();
}

function renderChecklist() {
  const start = document.getElementById('cl-start').value;
  const end = document.getElementById('cl-end').value;
  const filtered = db.workLogs.filter(l => l.work_date >= start && l.work_date <= end)
    .sort((a, b) => b.work_date.localeCompare(a.work_date));

  // Employee summary
  const empSummary = db.employees.map(e => {
    const total = filtered.filter(l => l.status === 'Confirmado')
      .reduce((s, l) => s + ((l.work_log_employees||[]).find(we => we.employee_id === e.id)?.payment_amount || 0), 0);
    const count = filtered.filter(l => l.status === 'Confirmado' && (l.work_log_employees||[]).some(we => we.employee_id === e.id)).length;
    return { ...e, total, count };
  }).filter(e => e.total > 0);

  document.getElementById('emp-payments-summary').innerHTML = empSummary.length === 0
    ? '<p style="color:var(--text-muted);font-size:13px">Nenhum pagamento no per√≠odo</p>'
    : empSummary.map(e => `
        <div class="summary-block">
          <div>
            <div class="emp-name">${e.name}</div>
            <div class="emp-count">${e.count} trabalho(s)</div>
          </div>
          <div class="emp-total">${fmt(e.total)}</div>
        </div>
      `).join('');

  const confirmed = filtered.filter(l => l.status === 'Confirmado');
  const cancelled = filtered.filter(l => l.status === 'Cancelado');
  const pending = filtered.filter(l => l.status === 'Pendente');
  const totalRev = confirmed.reduce((s, l) => s + l.revenue, 0);
  const totalPay = confirmed.reduce((s, l) => s + (l.work_log_employees||[]).reduce((ps, e) => ps + e.payment_amount, 0), 0);

  document.getElementById('cl-period-stats').innerHTML = `
    <div class="summary-block">
      <span>Pendentes</span>
      <span class="badge badge-pending">${pending.length}</span>
    </div>
    <div class="summary-block">
      <span>Confirmados</span>
      <span class="badge badge-secondary">${confirmed.length}</span>
    </div>
    <div class="summary-block">
      <span>Cancelados</span>
      <span class="badge badge-destructive">${cancelled.length}</span>
    </div>
    <div class="summary-block">
      <span>Faturamento</span>
      <strong style="color:var(--secondary)">${fmt(totalRev)}</strong>
    </div>
    <div class="summary-block">
      <span>Pagamentos</span>
      <strong style="color:var(--destructive)">${fmt(totalPay)}</strong>
    </div>
  `;

  document.getElementById('work-logs-list').innerHTML = filtered.map(l => {
    const cl = getClient(l.client_id);
    const emps = (l.work_log_employees||[]).map(we => {
      const emp = getEmployee(we.employee_id);
      return `${emp?.name || '?'}: ${fmt(we.payment_amount)}`;
    }).join(' | ');
    const statusBadge = l.status === 'Confirmado'
      ? 'badge-secondary' : l.status === 'Cancelado'
      ? 'badge-destructive' : 'badge-pending';
    return `
      <div class="log-row">
        <div class="log-info">
          <div class="log-date">${fmtDate(l.work_date)}</div>
          <div class="log-client">${cl?.name || '?'}</div>
          ${emps ? `<div class="log-employees">${emps}</div>` : ''}
          ${l.cancellation_reason ? `<div style="font-size:12px;color:var(--destructive);margin-top:2px">Cancelado: ${l.cancellation_reason}</div>` : ''}
        </div>
        <div style="text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:6px">
          <span class="badge ${statusBadge}">${l.status}</span>
          ${l.status === 'Confirmado' ? `<div class="log-revenue">${fmt(l.revenue)}</div>` : ''}
          <div style="display:flex;gap:4px">
            <button class="btn btn-ghost btn-icon btn-sm" title="Editar" onclick="editWorkLog('${l.id}')">‚úè</button>
            <button class="btn btn-danger btn-icon btn-sm" title="Apagar" onclick="deleteWorkLog('${l.id}')">üóë</button>
          </div>
        </div>
      </div>
    `;
  }).join('') || '<div class="empty"><div class="icon">üìã</div>Nenhum registro no per√≠odo</div>';
}

function addEmpRow() {
  const container = document.getElementById('cl-emp-rows');
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;gap:8px;margin-bottom:8px;align-items:center';
  div.innerHTML = `
    <select class="form-control emp-row-emp" style="flex:1">
      ${db.employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('')}
    </select>
    <input type="number" class="form-control emp-row-pay" placeholder="R$" step="0.01" style="width:100px"/>
    <button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function openAddWorkLog() {
  document.getElementById('checklist-modal-title').textContent = 'üíµ Novo Registro de Trabalho';
  document.getElementById('cl-edit-id').value = '';
  document.getElementById('cl-client').value = '';
  document.getElementById('cl-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('cl-status').value = 'Pendente';
  document.getElementById('cl-reason').value = '';
  document.getElementById('cl-reason-group').style.display = 'none';
  document.getElementById('cl-revenue').value = '';
  document.getElementById('cl-emp-rows').innerHTML = '';
  openModal('checklist-modal');
}

function editWorkLog(id) {
  const l = db.workLogs.find(w => w.id === id);
  if (!l) return;
  document.getElementById('checklist-modal-title').textContent = '‚úè Editar Registro';
  document.getElementById('cl-edit-id').value = id;
  document.getElementById('cl-client').value = l.client_id;
  document.getElementById('cl-date').value = l.work_date;
  document.getElementById('cl-status').value = l.status;
  document.getElementById('cl-reason').value = l.cancellation_reason || '';
  document.getElementById('cl-reason-group').style.display = l.status === 'Cancelado' ? 'block' : 'none';
  document.getElementById('cl-revenue').value = l.revenue || '';
  const container = document.getElementById('cl-emp-rows');
  container.innerHTML = '';
  (l.work_log_employees || []).forEach(we => {
    const div = document.createElement('div');
    div.style.cssText = 'display:flex;gap:8px;margin-bottom:8px;align-items:center';
    div.innerHTML = `
      <select class="form-control emp-row-emp" style="flex:1">
        ${db.employees.map(e => `<option value="${e.id}" ${e.id === we.employee_id ? 'selected' : ''}>${e.name}</option>`).join('')}
      </select>
      <input type="number" class="form-control emp-row-pay" value="${we.payment_amount}" step="0.01" style="width:100px"/>
      <button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>
    `;
    container.appendChild(div);
  });
  openModal('checklist-modal');
}

function saveWorkLog() {
  const editId = document.getElementById('cl-edit-id').value;
  const clientId = document.getElementById('cl-client').value;
  const date = document.getElementById('cl-date').value;
  const status = document.getElementById('cl-status').value;
  const reason = document.getElementById('cl-reason').value;
  const revenue = parseFloat(document.getElementById('cl-revenue').value) || 0;
  if (!clientId || !date) { toast('Preencha cliente e data','error'); return; }
  const emps = [...document.querySelectorAll('#cl-emp-rows > div')].map(div => ({
    employee_id: div.querySelector('.emp-row-emp').value,
    payment_amount: parseFloat(div.querySelector('.emp-row-pay').value) || 0,
  }));
  if (editId) {
    const l = db.workLogs.find(w => w.id === editId);
    if (l) {
      l.client_id = clientId; l.work_date = date; l.status = status;
      l.cancellation_reason = reason;
      l.revenue = status === 'Confirmado' ? revenue : 0;
      l.work_log_employees = emps;
    }
    toast('Registro atualizado!','success');
  } else {
    db.workLogs.push({ id: uid(), client_id: clientId, work_date: date, status, cancellation_reason: reason, revenue: status === 'Confirmado' ? revenue : 0, work_log_employees: emps });
    toast('Registro adicionado!','success');
  }
  closeModal('checklist-modal');
  document.getElementById('cl-emp-rows').innerHTML = '';
  renderChecklist();
  renderDashboard();
}
document.getElementById('cl-status').addEventListener('change', function() {
  document.getElementById('cl-reason-group').style.display = this.value === 'Cancelado' ? 'block' : 'none';
});
function deleteWorkLog(id) {
  if (!confirm('Remover registro?')) return;
  db.workLogs = db.workLogs.filter(l => l.id !== id);
  toast('Registro removido','success');
  renderChecklist();
  renderDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLIENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClients() {
  document.getElementById('clients-table-body').innerHTML = db.clients.map(c => {
    const emps = (c.client_employees || []).map(ce => {
      const emp = getEmployee(ce.employee_id);
      return `<span class="emp-pill">${emp?.name || '?'} ${fmt(ce.payment_amount)}</span>`;
    }).join(' ');
    return `
      <tr>
        <td><strong>${c.name}</strong></td>
        <td><span class="badge badge-gray">${c.frequency}</span></td>
        <td><strong style="color:var(--secondary)">${fmt(c.price)}</strong></td>
        <td>${emps || '<span style="color:var(--text-muted)">Nenhuma</span>'}</td>
        <td>${c.no_transport_cost ? '<span class="badge badge-secondary">Sim</span>' : '<span class="badge badge-gray">N√£o</span>'}</td>
        <td>
          <div style="display:flex;gap:4px">
            <button class="btn btn-ghost btn-icon btn-sm" onclick="editClient('${c.id}')">‚úè</button>
            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteClient('${c.id}')">üóë</button>
          </div>
        </td>
      </tr>
    `;
  }).join('');
}

function addClientEmpRow() {
  const container = document.getElementById('client-emp-rows');
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;gap:8px;margin-bottom:8px;align-items:center';
  div.innerHTML = `
    <select class="form-control cemp-row-emp" style="flex:1">
      ${db.employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('')}
    </select>
    <input type="number" class="form-control cemp-row-pay" placeholder="R$" step="0.01" style="width:100px"/>
    <button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function openAddClient() {
  document.getElementById('client-modal-title').textContent = 'üë• Adicionar Cliente';
  document.getElementById('client-edit-id').value = '';
  document.getElementById('client-name').value = '';
  document.getElementById('client-freq').value = '';
  document.getElementById('client-price').value = '';
  document.getElementById('client-transport').checked = false;
  document.getElementById('client-emp-rows').innerHTML = '';
  openModal('client-modal');
}
document.querySelector('[onclick="openModal(\'client-modal\')"]').setAttribute('onclick', 'openAddClient()');

function editClient(id) {
  const c = db.clients.find(cl => cl.id === id);
  if (!c) return;
  document.getElementById('client-modal-title').textContent = '‚úè Editar Cliente';
  document.getElementById('client-edit-id').value = id;
  document.getElementById('client-name').value = c.name;
  document.getElementById('client-freq').value = c.frequency;
  document.getElementById('client-price').value = c.price;
  document.getElementById('client-transport').checked = c.no_transport_cost;
  const container = document.getElementById('client-emp-rows');
  container.innerHTML = '';
  (c.client_employees || []).forEach(ce => {
    const div = document.createElement('div');
    div.style.cssText = 'display:flex;gap:8px;margin-bottom:8px;align-items:center';
    div.innerHTML = `
      <select class="form-control cemp-row-emp" style="flex:1">
        ${db.employees.map(e => `<option value="${e.id}" ${e.id === ce.employee_id ? 'selected' : ''}>${e.name}</option>`).join('')}
      </select>
      <input type="number" class="form-control cemp-row-pay" value="${ce.payment_amount}" step="0.01" style="width:100px"/>
      <button class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>
    `;
    container.appendChild(div);
  });
  openModal('client-modal');
}

function saveClient() {
  const id = document.getElementById('client-edit-id').value;
  const name = document.getElementById('client-name').value.trim();
  const freq = document.getElementById('client-freq').value;
  const price = parseFloat(document.getElementById('client-price').value) || 0;
  const noTransport = document.getElementById('client-transport').checked;
  if (!name || !freq) { toast('Preencha nome e frequ√™ncia','error'); return; }
  const emps = [...document.querySelectorAll('#client-emp-rows > div')].map(div => ({
    employee_id: div.querySelector('.cemp-row-emp').value,
    payment_amount: parseFloat(div.querySelector('.cemp-row-pay').value) || 0,
  }));
  if (id) {
    const c = db.clients.find(cl => cl.id === id);
    if (c) { c.name = name; c.frequency = freq; c.price = price; c.no_transport_cost = noTransport; c.client_employees = emps; }
    toast('Cliente atualizado!','success');
  } else {
    db.clients.push({ id: uid(), name, frequency: freq, price, no_transport_cost: noTransport, client_employees: emps });
    toast('Cliente adicionado!','success');
  }
  closeModal('client-modal');
  renderClients();
}

function deleteClient(id) {
  if (!confirm('Remover cliente?')) return;
  db.clients = db.clients.filter(c => c.id !== id);
  toast('Cliente removido','success');
  renderClients();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function empTab(btn, section) {
  document.querySelectorAll('.tabs-nav .tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('active-emps').classList.toggle('hidden', section !== 'active-emps');
  document.getElementById('pending-users').classList.toggle('hidden', section !== 'pending-users');
}

function renderEmployees() {
  document.getElementById('emp-table-body').innerHTML = db.employees.map(e => `
    <tr>
      <td><strong>${e.name}</strong></td>
      <td>${e.email}</td>
      <td>${fmtDate(e.created_at)}</td>
      <td>
        <button class="btn btn-danger btn-icon btn-sm" onclick="deleteEmployee('${e.id}')">üóë</button>
      </td>
    </tr>
  `).join('');

  document.getElementById('pending-list').innerHTML = db.pendingUsers.length === 0
    ? '<div class="empty"><div class="icon">‚úÖ</div>Nenhum usu√°rio pendente</div>'
    : db.pendingUsers.map(u => `
        <div class="log-row">
          <div class="log-info">
            <div class="log-client">${u.email}</div>
            <div class="log-date">Registrado em ${fmtDate(u.created_at.split('T')[0])}</div>
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-secondary btn-sm" onclick="openApprove('${u.id}','${u.email}')">‚úÖ Aprovar</button>
            <button class="btn btn-danger btn-sm" onclick="rejectUser('${u.id}')">‚ùå Rejeitar</button>
          </div>
        </div>
      `).join('');
}

function saveEmployee() {
  const name = document.getElementById('emp-name').value.trim();
  const email = document.getElementById('emp-email').value.trim();
  if (!name || !email) { toast('Preencha nome e email','error'); return; }
  db.employees.push({ id: uid(), name, email, created_at: new Date().toISOString().split('T')[0] });
  closeModal('emp-modal');
  document.getElementById('emp-name').value = '';
  document.getElementById('emp-email').value = '';
  document.getElementById('emp-pass').value = '';
  toast('Funcion√°rio criado!','success');
  renderEmployees();
  populateSelects();
}

function deleteEmployee(id) {
  if (!confirm('Remover funcion√°rio?')) return;
  db.employees = db.employees.filter(e => e.id !== id);
  toast('Funcion√°rio removido','success');
  renderEmployees();
}

function openApprove(id, email) {
  document.getElementById('approve-user-id').value = id;
  document.getElementById('approve-name').value = email.split('@')[0];
  openModal('approve-modal');
}

function approveUser() {
  const id = document.getElementById('approve-user-id').value;
  const name = document.getElementById('approve-name').value.trim();
  if (!name) { toast('Informe o nome','error'); return; }
  const u = db.pendingUsers.find(p => p.id === id);
  if (u) {
    db.employees.push({ id: uid(), name, email: u.email, created_at: new Date().toISOString().split('T')[0] });
    db.pendingUsers = db.pendingUsers.filter(p => p.id !== id);
  }
  closeModal('approve-modal');
  toast('Funcion√°rio aprovado!','success');
  renderEmployees();
}

function rejectUser(id) {
  if (!confirm('Rejeitar usu√°rio?')) return;
  db.pendingUsers = db.pendingUsers.filter(p => p.id !== id);
  toast('Usu√°rio rejeitado','success');
  renderEmployees();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COSTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCosts() {
  const recurrent = db.costs.filter(c => c.cost_type === 'recorrente').reduce((s, c) => s + c.amount, 0);
  const unique = db.costs.filter(c => c.cost_type === 'unico').reduce((s, c) => s + c.amount, 0);
  document.getElementById('cost-recurrent').textContent = fmt(recurrent);
  document.getElementById('cost-unique').textContent = fmt(unique);

  const list = costsFilter === 'all' ? db.costs : db.costs.filter(c => c.cost_type === costsFilter);
  document.getElementById('costs-list').innerHTML = list.map(c => `
    <div class="cost-item">
      <div>
        <div class="cost-cat">${c.category} ‚Ä¢ <span class="badge ${c.cost_type === 'recorrente' ? 'badge-primary' : 'badge-warning'}">${c.cost_type}</span></div>
        <div class="cost-desc">${c.description}</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="cost-amount" style="color:${c.cost_type === 'recorrente' ? 'var(--primary)' : 'var(--warning)'}">${fmt(c.amount)}</div>
        <button class="btn btn-danger btn-icon btn-sm" onclick="deleteCost('${c.id}')">üóë</button>
      </div>
    </div>
  `).join('') || '<div class="empty"><div class="icon">üßæ</div>Nenhum custo encontrado</div>';
}

function filterCosts(type, btn) {
  costsFilter = type;
  document.querySelectorAll('#tab-costs .btn-outline').forEach(b => b.style.background = '');
  btn.style.background = 'var(--primary-light)';
  renderCosts();
}

function saveCost() {
  const cat = document.getElementById('cost-cat').value;
  const desc = document.getElementById('cost-desc').value.trim();
  const amount = parseFloat(document.getElementById('cost-amount').value) || 0;
  const type = document.getElementById('cost-type').value;
  if (!desc || amount <= 0) { toast('Preencha todos os campos','error'); return; }
  db.costs.push({ id: uid(), category: cat, description: desc, amount, cost_type: type, created_at: new Date().toISOString().split('T')[0] });
  closeModal('cost-modal');
  toast('Custo adicionado!','success');
  renderCosts();
}

function deleteCost(id) {
  if (!confirm('Remover custo?')) return;
  db.costs = db.costs.filter(c => c.id !== id);
  toast('Custo removido','success');
  renderCosts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderNotifications() {
  const pending = db.notifications.filter(n => n.status === 'pending');
  const read = db.notifications.filter(n => n.status === 'read');

  const notifHtml = (n, type) => {
    const cl = getClient(n.client_id);
    const emp = getEmployee(n.employee_id);
    const d = new Date(n.created_at);
    return `
      <div class="notif-item ${type}">
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px">
          <div>
            <div style="font-weight:700">Cliente: ${cl?.name || '?'}</div>
            <div style="font-size:13px;color:var(--primary);margin-top:2px">üë§ ${emp?.name || '?'}</div>
          </div>
          <div style="font-size:11px;color:var(--text-muted)">${d.toLocaleDateString('pt-BR')} ${d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</div>
        </div>
        <div style="background:var(--bg);border-radius:6px;padding:10px;font-size:13px;margin-bottom:10px">"${n.note}"</div>
        <div style="display:flex;gap:6px">
          ${type === 'pending' ? `<button class="btn btn-primary btn-sm" onclick="markNotifRead('${n.id}')">‚úì Marcar como lida</button>` : ''}
          <button class="btn btn-danger btn-sm" onclick="deleteNotif('${n.id}')">üóë Excluir</button>
        </div>
      </div>
    `;
  };

  document.getElementById('notifications-list').innerHTML =
    (pending.length > 0 ? `<h3 style="font-size:16px;font-weight:700;color:var(--destructive);margin-bottom:10px">Pendentes</h3>` + pending.map(n => notifHtml(n,'pending')).join('') : '') +
    (read.length > 0 ? `<hr class="divider"><h3 style="font-size:16px;font-weight:700;color:var(--text-muted);margin-bottom:10px">Lidas</h3>` + read.map(n => notifHtml(n,'read')).join('') : '') +
    (db.notifications.length === 0 ? '<div class="empty"><div class="icon">üîî</div>Nenhuma notifica√ß√£o</div>' : '');
}

function markNotifRead(id) {
  const n = db.notifications.find(n => n.id === id);
  if (n) n.status = 'read';
  toast('Notifica√ß√£o marcada como lida','success');
  updateNotifBadge();
  renderNotifications();
}

function deleteNotif(id) {
  if (!confirm('Excluir notifica√ß√£o?')) return;
  db.notifications = db.notifications.filter(n => n.id !== id);
  toast('Notifica√ß√£o exclu√≠da','success');
  updateNotifBadge();
  renderNotifications();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FREQUENCIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFrequencies() {
  document.getElementById('freq-list').innerHTML = db.frequencies.length === 0
    ? '<div class="empty"><div class="icon">üìÜ</div>Nenhuma frequ√™ncia cadastrada</div>'
    : db.frequencies.map(f => `
        <div class="freq-item">
          <span style="font-weight:600">${f.name}</span>
          <div style="display:flex;gap:4px">
            <button class="btn btn-ghost btn-icon btn-sm" onclick="editFreq('${f.id}')">‚úè</button>
            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteFreq('${f.id}')">üóë</button>
          </div>
        </div>
      `).join('');
}

function saveFreq() {
  const id = document.getElementById('freq-edit-id').value;
  const name = document.getElementById('freq-name').value.trim();
  if (!name) { toast('Digite o nome','error'); return; }
  if (id) {
    const f = db.frequencies.find(f => f.id === id);
    if (f) f.name = name;
    toast('Frequ√™ncia atualizada!','success');
  } else {
    db.frequencies.push({ id: uid(), name });
    toast('Frequ√™ncia adicionada!','success');
  }
  closeModal('freq-modal');
  document.getElementById('freq-edit-id').value = '';
  document.getElementById('freq-name').value = '';
  renderFrequencies();
  populateSelects();
}

function editFreq(id) {
  const f = db.frequencies.find(f => f.id === id);
  if (!f) return;
  document.getElementById('freq-modal-title').textContent = '‚úè Editar Frequ√™ncia';
  document.getElementById('freq-edit-id').value = id;
  document.getElementById('freq-name').value = f.name;
  openModal('freq-modal');
}

function deleteFreq(id) {
  if (!confirm('Remover frequ√™ncia?')) return;
  db.frequencies = db.frequencies.filter(f => f.id !== id);
  toast('Frequ√™ncia removida','success');
  renderFrequencies();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REFERRALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReferrals() {
  const pending = db.referrals.filter(r => r.status === 'pending');
  const approved = db.referrals.filter(r => r.status === 'approved');
  const rejected = db.referrals.filter(r => r.status === 'rejected');

  document.getElementById('referral-stats').innerHTML = `
    <div class="stat-card" style="border-left:4px solid var(--warning)">
      <div class="stat-label">‚è≥ Pendentes</div>
      <div class="stat-value">${pending.length}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)">
      <div class="stat-label">‚úÖ Aprovadas</div>
      <div class="stat-value text-secondary">${approved.length}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--destructive)">
      <div class="stat-label">‚ùå Rejeitadas</div>
      <div class="stat-value text-destructive">${rejected.length}</div>
    </div>
  `;

  const refHtml = r => {
    const emp = getEmployee(r.employee_id);
    return `
      <div class="referral-item ${r.status}" style="margin-bottom:8px">
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px">
          <div>
            <div style="font-weight:700;font-size:15px">${r.client_name}</div>
            <div style="font-size:12px;color:var(--text-muted)">üë§ Indicado por: ${emp?.name || '?'}</div>
          </div>
          <div style="display:flex;align-items:center;gap:6px">
            <span class="badge ${r.status === 'pending' ? 'badge-warning' : r.status === 'approved' ? 'badge-secondary' : 'badge-destructive'}">
              ${r.status === 'pending' ? 'Pendente' : r.status === 'approved' ? 'Aprovado' : 'Rejeitado'}
            </span>
            <button class="btn btn-danger btn-icon btn-sm" title="Apagar" onclick="deleteReferral('${r.id}')">üóë</button>
          </div>
        </div>
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px">
          üìû ${r.phone} | üìç ${r.address} | üìÆ ${r.zip_code}
        </div>
        ${r.bonus_amount > 0 ? `<div style="font-size:13px;font-weight:600;color:var(--secondary);margin-bottom:8px">üéÅ B√¥nus: ${fmt(r.bonus_amount)}</div>` : ''}
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          ${r.status === 'pending' ? `
            <button class="btn btn-secondary btn-sm" onclick="openRefApprove('${r.id}')">‚úÖ Aprovar</button>
            <button class="btn btn-danger btn-sm" onclick="rejectRef('${r.id}')">‚ùå Rejeitar</button>
          ` : ''}
          ${r.status === 'approved' ? `
            <button class="btn btn-outline btn-sm" onclick="pendingRef('${r.id}')">‚Ü© Voltar para Pendente</button>
            <button class="btn btn-danger btn-sm" onclick="rejectRef('${r.id}')">‚ùå Rejeitar</button>
          ` : ''}
          ${r.status === 'rejected' ? `
            <button class="btn btn-outline btn-sm" onclick="pendingRef('${r.id}')">‚Ü© Voltar para Pendente</button>
            <button class="btn btn-secondary btn-sm" onclick="openRefApprove('${r.id}')">‚úÖ Aprovar</button>
          ` : ''}
        </div>
      </div>
    `;
  };

  document.getElementById('referrals-list').innerHTML =
    (pending.length ? `<h3 style="font-weight:700;margin-bottom:10px;color:var(--warning)">Pendentes</h3>` + pending.map(refHtml).join('') : '') +
    (approved.length ? `<h3 style="font-weight:700;margin:16px 0 10px;color:var(--secondary)">Aprovadas</h3>` + approved.map(refHtml).join('') : '') +
    (rejected.length ? `<h3 style="font-weight:700;margin:16px 0 10px;color:var(--destructive)">Rejeitadas</h3>` + rejected.map(refHtml).join('') : '') +
    (db.referrals.length === 0 ? '<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o</div>' : '');
}

function openRefApprove(id) {
  document.getElementById('ref-edit-id').value = id;
  document.getElementById('ref-bonus').value = '';
  openModal('ref-modal');
}

function approveReferral() {
  const id = document.getElementById('ref-edit-id').value;
  const bonus = parseFloat(document.getElementById('ref-bonus').value) || 0;
  if (bonus <= 0) { toast('Informe um valor de b√¥nus v√°lido','error'); return; }
  const r = db.referrals.find(r => r.id === id);
  if (r) { r.status = 'approved'; r.bonus_amount = bonus; }
  closeModal('ref-modal');
  toast('Indica√ß√£o aprovada!','success');
  renderReferrals();
}

function rejectRef(id) {
  if (!confirm('Rejeitar indica√ß√£o?')) return;
  const r = db.referrals.find(r => r.id === id);
  if (r) r.status = 'rejected';
  toast('Indica√ß√£o rejeitada','success');
  renderReferrals();
}

function deleteReferral(id) {
  if (!confirm('Apagar esta indica√ß√£o permanentemente?')) return;
  db.referrals = db.referrals.filter(r => r.id !== id);
  toast('Indica√ß√£o apagada','success');
  renderReferrals();
}

function pendingRef(id) {
  const r = db.referrals.find(r => r.id === id);
  if (r) { r.status = 'pending'; r.bonus_amount = 0; }
  toast('Indica√ß√£o voltou para Pendente','success');
  renderReferrals();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE APP LOGIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let empWeekOffset = 0;
let currentEmpId = null;
let empPeriodDates = { start: '', end: '' };

function initEmpApp(empId) {
  currentEmpId = empId;
  setEmpPeriod('mes', null);
  // Populate note client select with this employee's clients
  const myClients = db.clients.filter(c => (c.client_employees||[]).some(ce => ce.employee_id === empId));
  const sel = document.getElementById('note-client-sel');
  sel.innerHTML = myClients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
  renderEmpGanhos();
  renderEmpAgenda();
  renderEmpClients();
  renderEmpReferrals();
}

function empNavigate(btn) {
  const tab = btn.getAttribute('data-etab');
  document.querySelectorAll('.emp-tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
}

// ‚îÄ‚îÄ GANHOS ‚îÄ‚îÄ
function setEmpPeriod(period, btn) {
  const now = new Date();
  if (btn) {
    document.querySelectorAll('#tab-emp-ganhos .btn').forEach(b => { b.className = b.className.replace('btn-primary','btn-outline'); });
    btn.className = btn.className.replace('btn-outline','btn-primary');
  }
  if (period === 'semana') {
    const ws = new Date(now); ws.setDate(now.getDate() - now.getDay());
    const we = new Date(ws); we.setDate(ws.getDate() + 6);
    empPeriodDates = { start: ws.toISOString().split('T')[0], end: we.toISOString().split('T')[0] };
  } else if (period === 'mes') {
    empPeriodDates = {
      start: new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0],
      end: new Date(now.getFullYear(), now.getMonth()+1, 0).toISOString().split('T')[0]
    };
  } else {
    empPeriodDates = {
      start: new Date(now.getFullYear(), 0, 1).toISOString().split('T')[0],
      end: new Date(now.getFullYear(), 11, 31).toISOString().split('T')[0]
    };
  }
  renderEmpGanhos();
}

function renderEmpGanhos() {
  const { start, end } = empPeriodDates;
  const empId = currentEmpId;

  // Filter work logs where this employee participated
  const myLogs = db.workLogs.filter(l =>
    l.work_date >= start && l.work_date <= end &&
    l.status === 'Confirmado' &&
    (l.work_log_employees||[]).some(we => we.employee_id === empId)
  );

  const myEarnings = myLogs.reduce((s, l) => {
    const we = (l.work_log_employees||[]).find(we => we.employee_id === empId);
    return s + (we ? we.payment_amount : 0);
  }, 0);

  // Approved referral bonuses
  const myBonuses = db.referrals.filter(r => r.employee_id === empId && r.status === 'approved')
    .reduce((s, r) => s + r.bonus_amount, 0);

  document.getElementById('emp-stats').innerHTML = `
    <div class="stat-card" style="border-left:4px solid var(--primary)">
      <div class="stat-label">üíµ Meus Ganhos</div>
      <div class="stat-value text-primary">${fmt(myEarnings)}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)">
      <div class="stat-label">üéÅ B√¥nus de Indica√ß√µes</div>
      <div class="stat-value text-secondary">${fmt(myBonuses)}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--warning)">
      <div class="stat-label">üìÖ Total de Trabalhos</div>
      <div class="stat-value" style="color:var(--warning)">${myLogs.length}</div>
    </div>
  `;

  document.getElementById('emp-work-list').innerHTML = myLogs.length === 0
    ? '<div class="empty"><div class="icon">üíµ</div>Nenhum trabalho no per√≠odo</div>'
    : myLogs.sort((a,b) => b.work_date.localeCompare(a.work_date)).map(l => {
        const cl = getClient(l.client_id);
        const we = (l.work_log_employees||[]).find(we => we.employee_id === empId);
        return `
          <div class="log-row">
            <div class="log-info">
              <div class="log-date">${fmtDate(l.work_date)}</div>
              <div class="log-client">${cl?.name || '?'}</div>
              <div class="log-employees">${cl?.frequency || ''}</div>
            </div>
            <div class="log-revenue">${fmt(we?.payment_amount || 0)}</div>
          </div>
        `;
      }).join('');
}

// ‚îÄ‚îÄ AGENDA FUNCION√ÅRIA ‚îÄ‚îÄ
function empPrevWeek() { empWeekOffset--; renderEmpAgenda(); }
function empNextWeek() { empWeekOffset++; renderEmpAgenda(); }

function renderEmpAgenda() {
  const base = getWeekStart(new Date());
  base.setDate(base.getDate() + empWeekOffset * 7);
  const days = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(base);
    d.setDate(base.getDate() + i);
    days.push(d);
  }
  const startStr = days[0].toISOString().split('T')[0];
  const endStr = days[6].toISOString().split('T')[0];
  const todayStr = new Date().toISOString().split('T')[0];
  const dayNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];

  document.getElementById('emp-week-label').textContent =
    `${days[0].toLocaleDateString('pt-BR',{day:'2-digit',month:'short'})} ‚Äì ${days[6].toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'})}`;

  // Filter only entries for this employee
  const myEntries = db.scheduleEntries.filter(e =>
    (e.employee_ids||[]).includes(currentEmpId) &&
    e.work_date >= startStr && e.work_date <= endStr
  );

  document.getElementById('emp-week-grid').innerHTML = days.map((d, i) => {
    const ds = d.toISOString().split('T')[0];
    const dayEntries = myEntries.filter(e => e.work_date === ds);
    return `
      <div class="day-col ${ds === todayStr ? 'today' : ''}">
        <div class="day-label">${dayNames[i]}</div>
        <div class="day-num">${d.getDate()}</div>
        ${dayEntries.map(e => {
          const cl = getClient(e.client_id);
          return `<div class="schedule-item ${e.status}">
            <div style="font-weight:600">${cl?.name || '?'}</div>
            <span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}" style="font-size:10px">${e.status}</span>
          </div>`;
        }).join('')}
      </div>
    `;
  }).join('');

  document.getElementById('emp-schedule-list').innerHTML = myEntries.length === 0
    ? '<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento nesta semana para voc√™</div>'
    : myEntries.sort((a,b) => a.work_date.localeCompare(b.work_date)).map(e => {
        const cl = getClient(e.client_id);
        return `
          <div class="log-row">
            <div class="log-info">
              <div class="log-date">${fmtDate(e.work_date)}</div>
              <div class="log-client">${cl?.name || '?'}</div>
              ${e.notes ? `<div style="font-size:12px;color:var(--text-muted);font-style:italic">"${e.notes}"</div>` : ''}
            </div>
            <span class="badge ${e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning'}">${e.status}</span>
          </div>
        `;
      }).join('');
}

// ‚îÄ‚îÄ CLIENTES FUNCION√ÅRIA ‚îÄ‚îÄ
function renderEmpClients() {
  const empId = currentEmpId;
  const myClients = db.clients.filter(c => (c.client_employees||[]).some(ce => ce.employee_id === empId));

  document.getElementById('emp-clients-list').innerHTML = myClients.length === 0
    ? '<div class="empty"><div class="icon">üë•</div>Nenhum cliente designado a voc√™</div>'
    : myClients.map(c => {
        const myCe = (c.client_employees||[]).find(ce => ce.employee_id === empId);
        return `
          <div class="log-row" style="margin-bottom:8px">
            <div class="log-info">
              <div class="log-client">${c.name}</div>
              <div class="log-employees">${c.frequency}</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:12px;color:var(--text-muted)">Meu pagamento</div>
              <div style="font-weight:700;color:var(--primary)">${fmt(myCe?.payment_amount || 0)}</div>
            </div>
          </div>
        `;
      }).join('');

  // Notes
  const myNotes = db.notifications.filter(n => n.employee_id === empId);
  document.getElementById('emp-notes-list').innerHTML = myNotes.length === 0
    ? '<p style="color:var(--text-muted);font-size:13px;padding:8px 0">Nenhuma observa√ß√£o enviada ainda</p>'
    : myNotes.map(n => {
        const cl = getClient(n.client_id);
        const d = new Date(n.created_at);
        return `
          <div style="border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px">
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:6px">
              <strong>${cl?.name || '?'}</strong>
              <span class="badge ${n.status==='pending'?'badge-warning':'badge-secondary'}">${n.status==='pending'?'Pendente':'Lida'}</span>
            </div>
            <div style="font-size:13px;color:var(--text-muted)">"${n.note}"</div>
            <div style="font-size:11px;color:var(--text-muted);margin-top:4px">${d.toLocaleDateString('pt-BR')}</div>
          </div>
        `;
      }).join('');
}

function saveEmpNote() {
  const clientId = document.getElementById('note-client-sel').value;
  const note = document.getElementById('note-text').value.trim();
  if (!note) { toast('Escreva sua observa√ß√£o','error'); return; }
  db.notifications.push({
    id: uid(),
    client_id: clientId,
    employee_id: currentEmpId,
    note,
    status: 'pending',
    created_at: new Date().toISOString()
  });
  document.getElementById('note-text').value = '';
  closeModal('emp-note-modal');
  toast('Observa√ß√£o enviada! O admin ser√° notificado.','success');
  renderEmpClients();
  updateNotifBadge();
}

// ‚îÄ‚îÄ REFERRALS FUNCION√ÅRIA ‚îÄ‚îÄ
function renderEmpReferrals() {
  const empId = currentEmpId;
  const myRefs = db.referrals.filter(r => r.employee_id === empId);
  const pending = myRefs.filter(r => r.status === 'pending');
  const approved = myRefs.filter(r => r.status === 'approved');
  const rejected = myRefs.filter(r => r.status === 'rejected');
  const totalBonus = approved.reduce((s,r) => s + r.bonus_amount, 0);

  document.getElementById('emp-referrals-stats').innerHTML = `
    <div class="stat-card" style="border-left:4px solid var(--warning)">
      <div class="stat-label">‚è≥ Pendentes</div>
      <div class="stat-value">${pending.length}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--secondary)">
      <div class="stat-label">‚úÖ Aprovadas</div>
      <div class="stat-value text-secondary">${approved.length}</div>
    </div>
    <div class="stat-card" style="border-left:4px solid var(--primary)">
      <div class="stat-label">üéÅ Total de B√¥nus</div>
      <div class="stat-value text-primary">${fmt(totalBonus)}</div>
    </div>
  `;

  document.getElementById('emp-referrals-list').innerHTML = myRefs.length === 0
    ? '<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o feita ainda. Indique um amigo!</div>'
    : myRefs.map(r => `
        <div class="referral-item ${r.status}" style="margin-bottom:8px">
          <div style="display:flex;justify-content:space-between;align-items:start">
            <div>
              <div style="font-weight:700">${r.client_name}</div>
              <div style="font-size:12px;color:var(--text-muted)">üìû ${r.phone} | üìç ${r.address}</div>
              <div style="font-size:11px;color:var(--text-muted)">${fmtDate(r.created_at)}</div>
            </div>
            <span class="badge ${r.status==='pending'?'badge-warning':r.status==='approved'?'badge-secondary':'badge-destructive'}">
              ${r.status==='pending'?'Pendente':r.status==='approved'?'Aprovado':'Rejeitado'}
            </span>
          </div>
          ${r.bonus_amount > 0 ? `<div style="margin-top:8px;font-weight:700;color:var(--secondary)">üéÅ B√¥nus: ${fmt(r.bonus_amount)}</div>` : ''}
        </div>
      `).join('');
}

function saveEmpRef() {
  const name = document.getElementById('eref-name').value.trim();
  const phone = document.getElementById('eref-phone').value.trim();
  const address = document.getElementById('eref-address').value.trim();
  const zip = document.getElementById('eref-zip').value.trim();
  if (!name || !phone || !address || !zip) { toast('Preencha todos os campos','error'); return; }
  db.referrals.push({
    id: uid(), employee_id: currentEmpId,
    client_name: name, phone, address, zip_code: zip,
    status: 'pending', bonus_amount: 0, created_at: new Date().toISOString().split('T')[0]
  });
  document.getElementById('eref-name').value = '';
  document.getElementById('eref-phone').value = '';
  document.getEl
